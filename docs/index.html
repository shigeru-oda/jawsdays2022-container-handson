
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>[JAWS DAYS 2022] ハンズオン～コンテナサービスをCI/CDパイプラインでデプロイしよう～</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="[JAWS DAYS 2022] ハンズオン～コンテナサービスをCI/CDパイプラインでデプロイしよう～"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="はじめに" duration="5">
        <h2 is-upgraded>VPC?</h2>
<p>xx</p>
<h2 is-upgraded>CloudShell?</h2>
<p>xx</p>


      </google-codelab-step>
    
      <google-codelab-step label="VPC作成" duration="5">
        <h2 is-upgraded>CloudShellの起動</h2>
<h2 is-upgraded>VPCの作成</h2>
<p>東京リージョンにVPCを新規に作成します。</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-cmd" class="language-cmd">aws ec2 create-vpc \
    --cidr-block 10.0.0.0/16 \
    --tag-specification &#34;ResourceType=vpc,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-result" class="language-result">{
    &#34;Vpc&#34;: {
        &#34;CidrBlock&#34;: &#34;10.0.0.0/16&#34;,
        &#34;DhcpOptionsId&#34;: &#34;dopt-d50f23b2&#34;,
        &#34;State&#34;: &#34;pending&#34;,
        &#34;VpcId&#34;: &#34;vpc-00ee8367984814805&#34;,
        &#34;OwnerId&#34;: &#34;378647896848&#34;,
        &#34;InstanceTenancy&#34;: &#34;default&#34;,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;CidrBlockAssociationSet&#34;: [
            {
                &#34;AssociationId&#34;: &#34;vpc-cidr-assoc-08913abf335aba6a4&#34;,
                &#34;CidrBlock&#34;: &#34;10.0.0.0/16&#34;,
                &#34;CidrBlockState&#34;: {
                    &#34;State&#34;: &#34;associated&#34;
                }
            }
        ],
        &#34;IsDefault&#34;: false,
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOn&#34;
            }
        ]
    }
}
</code></pre>
<h2 is-upgraded>変数設定</h2>
<p>作成したVPC IDを取得します。</p>
<h3 is-upgraded>cmd</h3>
<pre><code>VpcId=`aws ec2 describe-vpcs \
    --query &#39;Vpcs[*].VpcId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`

cat &lt;&lt; EOF
VpcId : ${VpcId}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<p>IDが取得されていることを確認。以下は一例。</p>
<pre><code language="language-con" class="language-con">VpcId : vpc-08a77289b9b351429
</code></pre>
<h2 is-upgraded>Subnetの作成</h2>
<h3 is-upgraded>cmd1</h3>
<pre><code>aws ec2 create-subnet \
    --vpc-id $vpcid \
    --availability-zone ap-northeast-1a \
    --cidr-block 10.0.0.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>cmd2</h3>
<pre><code>aws ec2 create-subnet \
    --vpc-id $vpcid \
    --availability-zone ap-northeast-1c \
    --cidr-block 10.0.1.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>変数取得</h3>
<pre><code language="language-cmd1" class="language-cmd1">SubnetId1a=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1a&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-cmd2" class="language-cmd2">SubnetId1c=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1c&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code>cat &lt;&lt; EOF
VpcId : ${VpcId}
InternetGatewayId : ${InternetGatewayId}
SubnetId1a : ${SubnetId1a}
SubnetId1c : ${SubnetId1c}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code></code></pre>
<h2 is-upgraded>InternetGatewayの作成</h2>
<h3 is-upgraded>cmd1</h3>
<pre><code>aws ec2 create-internet-gateway \
    --tag-specifications &#34;ResourceType=internet-gateway,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result1</h3>
<pre><code></code></pre>
<h2 is-upgraded>変数設定</h2>
<p>作成したInternet GatewayのIDを取得します。</p>
<pre><code language="language-cmd1" class="language-cmd1">InternetGatewayId=`aws ec2 describe-internet-gateways \
    --query &#39;InternetGateways[*].InternetGatewayId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`

cat &lt;&lt; EOF
VpcId : ${VpcId}
InternetGatewayId : ${InternetGatewayId}
EOF
</code></pre>
<p>変数が取得されていること、以下は一例。</p>
<pre><code language="language-result1" class="language-result1">VpcId : vpc-08a77289b9b351429
InternetGatewayId : igw-0db61da9fcd82b6eb
</code></pre>
<h2 is-upgraded>InternetGatewayをVPCにAttach</h2>
<pre><code language="language-cmd1" class="language-cmd1">aws ec2 attach-internet-gateway \
    --internet-gateway-id ${InternetGatewayId} \
    --vpc-id ${VpcId}
</code></pre>
<pre><code language="language-result1" class="language-result1">何もなし
</code></pre>
<h2 is-upgraded>InternetGatewayをVPCにAttachされていることを確認</h2>
<pre><code language="language-cmd1" class="language-cmd1">aws ec2 describe-internet-gateways \
    --internet-gateway-ids ${InternetGatewayId} \
    --query &#39;InternetGateways[*].Attachments&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34;
</code></pre>
<p>Stateがavailableであること</p>
<pre><code language="language-result1" class="language-result1">[
    [
        {
            &#34;State&#34;: &#34;available&#34;,
            &#34;VpcId&#34;: &#34;vpc-08a77289b9b351429&#34;
        }
    ]
]
</code></pre>
<h2 is-upgraded>RouteTableにSubnetを関連付け</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-cmd1" class="language-cmd1">aws ec2 associate-route-table \
    --route-table-id rtb-22574640 \
    --subnet-id ${SubnetId1a}
</code></pre>
<pre><code language="language-cmd2" class="language-cmd2">aws ec2 associate-route-table \
    --route-table-id rtb-22574640 \
    --subnet-id ${SubnetId1c}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Cloud9作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="ECR作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="VPCエンドポイント作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="ALB作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="Fargate作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="動作確認" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodeBuild作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodeDeploy作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodePipeline作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="Dockerコンテナ再ビルド(Codeシリーズを利用)" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="動作確認" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="片付け" duration="5">
        <h2 is-upgraded>途中の見出し</h2>
<aside class="special"><p>何かお知らせを書きたい時のボックス</p>
</aside>
<aside class="warning"><p>何か注意点などを書きたい時のボックス</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
