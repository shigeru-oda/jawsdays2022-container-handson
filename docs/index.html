
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>[JAWS DAYS 2022] ãƒãƒ³ã‚ºã‚ªãƒ³ï½ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†ï½</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="[JAWS DAYS 2022] ãƒãƒ³ã‚ºã‚ªãƒ³ï½ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†ï½"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="ã”æŒ¨æ‹¶" duration="0">
        <h2 is-upgraded>â– ã”æŒ¨æ‹¶</h2>
<p>å½“è³‡æ–™ã¯<a href="https://jawsdays2022.jaws-ug.jp/" target="_blank">JAWS DAYS 2022 - Satellites</a>ã§ã®ãƒãƒ³ã‚ºã‚ªãƒ³ãƒˆãƒ©ãƒƒã‚¯ã®ä¸€ã¤ã€<a href="https://jaws-ug.doorkeeper.jp/events/141627" target="_blank">ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†</a>ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§åˆ©ç”¨ã™ã‚‹è³‡æ–™ã¨ãªã‚Šã¾ã™</p>
<p><a href="https://jawsdays2022.jaws-ug.jp/" target="_blank">JAWS DAYS 2022 - Satellites</a>ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã¯ä»¥ä¸‹3ç‚¹ã‚ã‚Šã¾ã™ãŒã€ä»–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯GUIã€CDKã§ã®ç’°å¢ƒæ§‹ç¯‰ã§ã‚ã£ãŸã®ã§ã€å½“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯CLIã§ã®ç’°å¢ƒæ§‹ç¯‰ã¨ã—ã¦æº–å‚™ã—ã¦ã„ã¾ã™</p>
<ul>
<li><a href="https://jaws-ug.doorkeeper.jp/events/141646" target="_blank">S3ã§Webã‚µã‚¤ãƒˆã‚’å…¬é–‹ã—ã¦ã€ãƒªã‚½ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã—ã¦ã¿ã‚ˆã†</a></li>
<li><a href="https://jaws-ug.doorkeeper.jp/events/141627" target="_blank">ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†</a></li>
<li><a href="https://jaws-ug.doorkeeper.jp/events/141651" target="_blank">CDKã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†</a></li>
</ul>
<p>åˆå¿ƒè€…ã®æ–¹ã«ã¯CLIã‚³ãƒãƒ³ãƒ‰ãŒé›£ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã¾ãšã¯ã“ã†ã„ã†ã‚¹ãƒ†ãƒƒãƒ—ãŒå¿…è¦ã¨ã„ã†å‹˜æ‰€ã ã‘ã§ã‚‚æ´ã‚“ã§é ‚ã‘ã‚Œã°å¹¸ã„ã§ã™ã€æ…£ã‚ŒãŸæ–¹ã¯CLIã‚³ãƒãƒ³ãƒ‰ã®1ã¤ï¼‘ã¤ã®æ„å‘³ã‚’ç†è§£ã™ã‚‹ã‚ˆã†ã«é€²ã‚ã¦é ‚ã‘ã‚‹ã¨ã‚ã‚ŠãŒãŸã„ã§ã™</p>
<h2 is-upgraded>â– å¯¾è±¡è€…</h2>
<ul>
<li>ã‚³ãƒ³ãƒ†ãƒŠãŒä½•ã‹ã‚ˆãåˆ†ã‹ã‚‰ãªã„äºº</li>
<li>ï¼¡ï¼·ï¼³ã§ã®ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’çŸ¥ã‚ŠãŸã„äºº</li>
<li>ï¼£ï¼©ï¼ï¼£ï¼¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã‚³ãƒ³ãƒ†ãƒŠã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„äºº</li>
</ul>
<h2 is-upgraded>â– å½“æ—¥ã¾ã§ã«ã”æº–å‚™ãŒå¿…è¦ãªã‚‚ã®</h2>
<ul>
<li>ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ãªAdministratoræ¨©é™ã®IAMãƒ¦ãƒ¼ã‚¶ãƒ¼</li>
<li>Chrome ã‚‚ã—ãã¯ Firefox</li>
</ul>
<h2 is-upgraded>â– å…è²¬äº‹é …ã«ã¤ã„ã¦</h2>
<p>ãƒãƒ³ã‚ºã‚ªãƒ³ã§åˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ä¸€éƒ¨èª²é‡‘å¯¾è±¡ã¨ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚ã”ã–ã„ã¾ã™<br> ã¾ãŸã€ãƒãƒ³ã‚ºã‚ªãƒ³ã§ä½œæˆã—ãŸç’°å¢ƒã‚’å‰Šé™¤ã—ãªã„å ´åˆã«ã¯ã€èª²é‡‘ãŒç¶šãã“ã¨ã«ã‚ˆã£ã¦é«˜é¡ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™<br> èª²é‡‘ãŒç™ºç”Ÿã—ãŸã“ã¨ã«ã‚ˆã‚‹è²¬ä»»ã¯è² ãˆã¾ã›ã‚“ã®ã§ã€ã”æ‰¿çŸ¥ãŠããã ã•ã„ ä¸Šè¨˜äº‹é …ã‚’ã”ç†è§£é ‚ããŠç”³è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™</p>
<h2 is-upgraded>â– å‚è€ƒè³‡æ–™</h2>
<ul>
<li><a href="https://pages.awscloud.com/rs/112-TZM-766/images/AWS_CICD_ECS_Handson.pdf" target="_blank">AWS CI/CD for Amazon ECS ãƒãƒ³ã‚ºã‚ªãƒ³~ Cloud9, Docker, Code Services ã‚’â½¤ã„ãŸé–‹ç™ºåŠ¹ç‡å‘ä¸Š ~</a></li>
<li><a href="https://www.slideshare.net/AmazonWebServicesJapan/20190731-black-belt-online-seminar-amazon-ecs-deep-dive-162160987" target="_blank">20190731 Black Belt Online Seminar Amazon ECS Deep Dive</a></li>
</ul>
<h2 is-upgraded>â– æ‰‹é †ã«ã¤ã„ã¦</h2>
<p>è²¼ã‚Šä»˜ã‘ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯æº–å‚™ã—ã¦ã„ã‚‹ã®ã§ã€åŸºæœ¬çš„ã«ã¯Copy &amp; Pasteã§æ‰‹é †ã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<p>cmdã¨è¨˜è¼‰ã•ã‚ŒãŸé …ç›®ã«ã‚ã‚‹ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºå†…å®¹ã¯ã‚³ãƒãƒ³ãƒ‰ã‚’Copy &amp; Pasteã™ã‚‹ãƒ¢ãƒã¨ãªã‚Šã¾ã™</p>
<pre><code language="language-Sample" class="language-Sample">Copy &amp; Pasteã®å¯¾è±¡ã§ã™
</code></pre>
<h3 is-upgraded>result</h3>
<p>resultã¨è¨˜è¼‰ã•ã‚ŒãŸé …ç›®ã«ã‚ã‚‹ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºå†…å®¹ã¯ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœã§ã™<br> IDãªã©ã¯å€‹ã€…ã«ç•°ãªã‚Šã¾ã™ã®ã§</p>
<ul>
<li>è¡¨ç¤ºãŒå¤§ããå¤‰ã‚ã‚‰ãªã„</li>
<li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ãªã„</li>
</ul>
<p>ã‚’ç¢ºèªãã ã•ã„</p>
<pre><code language="language-Sample" class="language-Sample">cmdå®Ÿè¡Œå¾Œã®çµæœã§ã™
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ãƒãƒ³ã‚ºã‚ªãƒ³ã‚’é€šã—ã¦å­¦ã¶ã“ã¨" duration="5">
        <h2 is-upgraded>â– ãƒãƒ³ã‚ºã‚ªãƒ³ï¼‘</h2>
<ul>
<li>VPCã‚’ä½¿ã£ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–¢ä¿‚ã®æ§‹ç¯‰</li>
<li>VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã£ãŸã‚»ã‚­ãƒ¥ã‚¢ç’°å¢ƒã®æ§‹ç¯‰</li>
<li>ECS /Fargateã‚’ä½¿ã£ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠé‹ç”¨ã®æ§‹ç¯‰</li>
</ul>
<p><strong>ã‚ã¨ã§å®Œæˆå›³ã‚’æŒ¿å…¥</strong></p>
<h2 is-upgraded>â– ãƒãƒ³ã‚ºã‚ªãƒ³ï¼’</h2>
<ul>
<li>CoceCommitã‚’ä½¿ã£ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç®¡ç†</li>
<li>CodeBuildã‚’ä½¿ã£ãŸè‡ªå‹•ãƒ“ãƒ«ãƒ‰</li>
<li>CodeDeployã‚’ä½¿ã£ãŸECS/Fargateã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</li>
<li>CodePipelineã‚’ä½¿ã£ãŸCI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰</li>
</ul>
<p><strong>ã‚ã¨ã§å®Œæˆå›³ã‚’æŒ¿å…¥</strong></p>


      </google-codelab-step>
    
      <google-codelab-step label="äº‹å‰æº–å‚™ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘¨ã‚Šã®æ§‹ç¯‰" duration="5">
        <h2 is-upgraded>â– CloudShellã®èµ·å‹•</h2>
<h3 is-upgraded>AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³</h3>
<p>ãƒ»Administratoræ¨©é™ã®IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã§AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³</p>
<p class="image-container"><img alt="img" src="img/8ec695a05f461637.png"></p>
<p>ãƒ»ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’<code>æ</code>±äº¬ã«å¤‰æ›´</p>
<p class="image-container"><img alt="img" src="img/a700f74d7e2e97dd.png"></p>
<h3 is-upgraded>CloudShellãƒœã‚¿ãƒ³æŠ¼ä¸‹</h3>
<p>ãƒ»ç”»é¢å³ä¸Šã®CloudShellãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹<br><img alt="img" src="img/1bbb070a4cf9999c.png"></p>
<h3 is-upgraded>CloudShellã‚’èµ·å‹•</h3>
<p>ãƒ»ä»Šå¾Œã¯CloudShellã®ç”»é¢ã«cmdã®å†…å®¹ã‚’Copy &amp; Pasteã—ã€resultã®å†…å®¹ã‚’ç¢ºèªã—é€²ã‚ã¦ä¸‹ã•ã„ <img alt="img" src="img/9b0f4ff0313865b9.png"></p>
<h2 is-upgraded>â– AWS Account IDã®å–å¾—</h2>
<p><img alt="img" src="img/f44362afeb0e4cfe.png"> ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID=`aws sts get-caller-identity --query Account --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
</code></pre>
<h2 is-upgraded>â– ECSã‚¿ã‚¹ã‚¯ã®å®Ÿè¡ŒRoleã®å­˜åœ¨ç¢ºèª</h2>
<p>ãƒ»ECSã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹Role(ecsTaskExecutionRole)ã®å­˜åœ¨ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws iam list-roles | grep &#34;RoleName&#34; | grep &#34;ecsTaskExecutionRole&#34;
</code></pre>
<h3 is-upgraded>resultï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">            &#34;RoleName&#34;: &#34;ecsTaskExecutionRole&#34;,
</code></pre>
<h3 is-upgraded>resultï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">ï¼ˆãªã—ï¼‰
</code></pre>
<h2 is-upgraded>â– ECSã®å®Ÿè¡ŒRoleä½œæˆï¼ˆRoleãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã¿å®Ÿè¡Œï¼‰</h2>
<p>ãƒ»ecsTaskExecutionRoleãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã¿å®Ÿè¡Œã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">cat &lt;&lt; EOF &gt; assume-role-policy-document.json
{
  &#34;Version&#34;: &#34;2012-10-17&#34;,
  &#34;Statement&#34;: [
    {
      &#34;Sid&#34;: &#34;&#34;,
      &#34;Effect&#34;: &#34;Allow&#34;,
      &#34;Principal&#34;: {
        &#34;Service&#34;: &#34;ecs-tasks.amazonaws.com&#34;
      },
      &#34;Action&#34;: &#34;sts:AssumeRole&#34;
    }
  ]
}
EOF
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">aws iam create-role \
  --role-name ecsTaskExecutionRole \
  --assume-role-policy-document file://assume-role-policy-document.json
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;Role&#34;: {
        &#34;Path&#34;: &#34;/&#34;,
        &#34;RoleName&#34;: &#34;ecsTaskExecutionRole&#34;,
        &#34;RoleId&#34;: &#34;AROASHENIAIFOV2DAKSWN&#34;,
        &#34;Arn&#34;: &#34;arn:aws:iam::123456789012:role/ecsTaskExecutionRole&#34;,
        &#34;CreateDate&#34;: &#34;2022-09-06T14:50:16+00:00&#34;,
        &#34;AssumeRolePolicyDocument&#34;: {
            &#34;Version&#34;: &#34;2012-10-17&#34;,
            &#34;Statement&#34;: [
                {
                    &#34;Sid&#34;: &#34;&#34;,
                    &#34;Effect&#34;: &#34;Allow&#34;,
                    &#34;Principal&#34;: {
                        &#34;Service&#34;: &#34;ecs-tasks.amazonaws.com&#34;
                    },
                    &#34;Action&#34;: &#34;sts:AssumeRole&#34;
                }
            ]
        }
    }
}
</code></pre>
<h2 is-upgraded>â– Roleã«Policyã‚’ã‚¢ã‚¿ãƒƒãƒï¼ˆRoleãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã¿å®Ÿè¡Œï¼‰</h2>
<p>ãƒ»ä½œæˆã—ãŸRoleã«Policyã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws iam attach-role-policy \
  --role-name ecsTaskExecutionRole \
  --policy-arn arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code>ï¼ˆãªã—ï¼‰
</code></pre>
<p>ãƒ»PolicyãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws iam list-attached-role-policies \
  --role-name ecsTaskExecutionRole \
  | grep &#39;AmazonECSTaskExecutionRolePolicy&#39;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">            &#34;PolicyName&#34;: &#34;AmazonECSTaskExecutionRolePolicy&#34;,
            &#34;PolicyArn&#34;: &#34;arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy&#34;
</code></pre>
<h2 is-upgraded>â– VPCã®ä½œæˆ</h2>
<p>ãƒ»VPCã‚’æ–°è¦ã«ä½œæˆã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-vpc \
    --cidr-block 10.0.0.0/16 \
    --tag-specification &#34;ResourceType=vpc,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Vpc&#34;: {
        &#34;CidrBlock&#34;: &#34;10.0.0.0/16&#34;,
        &#34;DhcpOptionsId&#34;: &#34;dopt-c3de3ba5&#34;,
        &#34;State&#34;: &#34;pending&#34;,
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;InstanceTenancy&#34;: &#34;default&#34;,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;CidrBlockAssociationSet&#34;: [
            {
                &#34;AssociationId&#34;: &#34;vpc-cidr-assoc-098ed848444db197b&#34;,
                &#34;CidrBlock&#34;: &#34;10.0.0.0/16&#34;,
                &#34;CidrBlockState&#34;: {
                    &#34;State&#34;: &#34;associated&#34;
                }
            }
        ],
        &#34;IsDefault&#34;: false,
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOn&#34;
            }
        ]
    }
}
</code></pre>
<h2 is-upgraded>â– VpcIdã®å–å¾—</h2>
<p>ãƒ»ä½œæˆã—ãŸVPC IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId=`aws ec2 describe-vpcs \
    --query &#39;Vpcs[*].VpcId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
EOF
</code></pre>
<h3 is-upgraded>results</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
</code></pre>
<h3 is-upgraded>â– DNSåå‰è§£æ±ºã‚’ONã«ã™ã‚‹</h3>
<p>ãƒ»ä½œæˆã—ãŸVPCã§ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³åã‹ã‚‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®å¤‰æ›ã€ã¾ãŸã¯ãã®é€†ã€ã‚’å¯èƒ½ã«ã—ã¾ã™<br> ãƒ»å¾Œç¨‹ä½œæˆã™ã‚‹VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¿…è¦ãªç‚ºã§ã™</p>
<h2 is-upgraded>cmd</h2>
<pre><code language="language-CloudShell" class="language-CloudShell"> aws ec2 modify-vpc-attribute \
  --vpc-id ${VpcId}  \
  --enable-dns-support  &#39;{&#34;Value&#34;:true}&#39; 
</code></pre>
<h2 is-upgraded>result</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">ï¼ˆãªã—ï¼‰
</code></pre>
<h3 is-upgraded>â– DNSåå‰è§£æ±ºã®çŠ¶æ…‹ç¢ºèª</h3>
<p>ãƒ»è¨­å®šå†…å®¹ãŒæ­£ã—ãåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h2 is-upgraded>cmd</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 describe-vpc-attribute \
  --query EnableDnsSupport \
  --vpc-id ${VpcId}  \
  --attribute enableDnsSupport
</code></pre>
<h2 is-upgraded>result</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Value&#34;: true
}
</code></pre>
<h3 is-upgraded>â– DNSãƒ›ã‚¹ãƒˆåã‚’ONã«ã™ã‚‹</h3>
<p>ãƒ»VPCå†…ã§DNSãƒ›ã‚¹ãƒˆå(ex : ip-10-0-0-23.ap-northeast-1.compute.internal)ã‚’æŒã¤ã‚ˆã†ã«è¨­å®šã—ã¾ã™<br> ãƒ»å¾Œç¨‹ä½œæˆã™ã‚‹VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¿…è¦ãªç‚ºã§ã™</p>
<h2 is-upgraded>cmd</h2>
<pre><code language="language-CloudShell" class="language-CloudShell"> aws ec2 modify-vpc-attribute \
  --vpc-id ${VpcId}  \
  --enable-dns-hostnames  &#39;{&#34;Value&#34;:true}&#39; 
</code></pre>
<h2 is-upgraded>result</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">ï¼ˆãªã—ï¼‰
</code></pre>
<h3 is-upgraded>â– DNSãƒ›ã‚¹ãƒˆåã®çŠ¶æ…‹ç¢ºèª</h3>
<p>ãƒ»è¨­å®šå†…å®¹ãŒæ­£ã—ãåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h2 is-upgraded>cmd</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 describe-vpc-attribute \
  --query EnableDnsHostnames \
  --vpc-id ${VpcId}  \
  --attribute enableDnsHostnames
</code></pre>
<h2 is-upgraded>result</h2>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Value&#34;: true
}
</code></pre>
<h2 is-upgraded>â– Subnetã®ä½œæˆ</h2>
<p>ãƒ»ä½œæˆã—ãŸVPCã®ä¸­ã«Subnetã‚’4ã¤ä½œæˆã—ã¾ã™ ãƒ»Private SubnetãŒ2ã¤ã€Public SubnetãŒ2ã¤ã§ã™</p>
<h3 is-upgraded>cmd (Public Subnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $VpcId \
    --availability-zone ap-northeast-1a \
    --cidr-block 10.0.0.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOnPublic}]&#34;
</code></pre>
<h3 is-upgraded>result (Public Subnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Subnet&#34;: {
        &#34;AvailabilityZone&#34;: &#34;ap-northeast-1a&#34;,
        &#34;AvailabilityZoneId&#34;: &#34;apne1-az4&#34;,
        &#34;AvailableIpAddressCount&#34;: 251,
        &#34;CidrBlock&#34;: &#34;10.0.0.0/24&#34;,
        &#34;DefaultForAz&#34;: false,
        &#34;MapPublicIpOnLaunch&#34;: false,
        &#34;State&#34;: &#34;available&#34;,
        &#34;SubnetId&#34;: &#34;subnet-0f66f257f167a1d47&#34;,
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;AssignIpv6AddressOnCreation&#34;: false,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPublic&#34;
            }
        ],
        &#34;SubnetArn&#34;: &#34;arn:aws:ec2:ap-northeast-1:123456789012:subnet/subnet-0f66f257f167a1d47&#34;,
        &#34;EnableDns64&#34;: false,
        &#34;Ipv6Native&#34;: false,
        &#34;PrivateDnsNameOptionsOnLaunch&#34;: {
            &#34;HostnameType&#34;: &#34;ip-name&#34;,
            &#34;EnableResourceNameDnsARecord&#34;: false,
            &#34;EnableResourceNameDnsAAAARecord&#34;: false
        }
    }
}
</code></pre>
<h3 is-upgraded>cmd (Public Subnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $VpcId \
    --availability-zone ap-northeast-1c \
    --cidr-block 10.0.1.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOnPublic}]&#34;
</code></pre>
<h3 is-upgraded>result (Public Subnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Subnet&#34;: {
        &#34;AvailabilityZone&#34;: &#34;ap-northeast-1c&#34;,
        &#34;AvailabilityZoneId&#34;: &#34;apne1-az1&#34;,
        &#34;AvailableIpAddressCount&#34;: 251,
        &#34;CidrBlock&#34;: &#34;10.0.1.0/24&#34;,
        &#34;DefaultForAz&#34;: false,
        &#34;MapPublicIpOnLaunch&#34;: false,
        &#34;State&#34;: &#34;available&#34;,
        &#34;SubnetId&#34;: &#34;subnet-0a1e2afffc8c140d8&#34;,
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;AssignIpv6AddressOnCreation&#34;: false,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPublic&#34;
            }
        ],
        &#34;SubnetArn&#34;: &#34;arn:aws:ec2:ap-northeast-1:123456789012:subnet/subnet-0a1e2afffc8c140d8&#34;,
        &#34;EnableDns64&#34;: false,
        &#34;Ipv6Native&#34;: false,
        &#34;PrivateDnsNameOptionsOnLaunch&#34;: {
            &#34;HostnameType&#34;: &#34;ip-name&#34;,
            &#34;EnableResourceNameDnsARecord&#34;: false,
            &#34;EnableResourceNameDnsAAAARecord&#34;: false
        }
    }
}
</code></pre>
<h3 is-upgraded>cmd (Private Subnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $VpcId \
    --availability-zone ap-northeast-1a \
    --cidr-block 10.0.2.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOnPrivate}]&#34;
</code></pre>
<h3 is-upgraded>result (Private Subnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Subnet&#34;: {
        &#34;AvailabilityZone&#34;: &#34;ap-northeast-1a&#34;,
        &#34;AvailabilityZoneId&#34;: &#34;apne1-az4&#34;,
        &#34;AvailableIpAddressCount&#34;: 251,
        &#34;CidrBlock&#34;: &#34;10.0.2.0/24&#34;,
        &#34;DefaultForAz&#34;: false,
        &#34;MapPublicIpOnLaunch&#34;: false,
        &#34;State&#34;: &#34;available&#34;,
        &#34;SubnetId&#34;: &#34;subnet-049f0119237ff00a0&#34;,
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;AssignIpv6AddressOnCreation&#34;: false,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPrivate&#34;
            }
        ],
        &#34;SubnetArn&#34;: &#34;arn:aws:ec2:ap-northeast-1:123456789012:subnet/subnet-049f0119237ff00a0&#34;,
        &#34;EnableDns64&#34;: false,
        &#34;Ipv6Native&#34;: false,
        &#34;PrivateDnsNameOptionsOnLaunch&#34;: {
            &#34;HostnameType&#34;: &#34;ip-name&#34;,
            &#34;EnableResourceNameDnsARecord&#34;: false,
            &#34;EnableResourceNameDnsAAAARecord&#34;: false
        }
    }
}
</code></pre>
<h3 is-upgraded>cmd (Private Subnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $VpcId \
    --availability-zone ap-northeast-1c \
    --cidr-block 10.0.3.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOnPrivate}]&#34;
</code></pre>
<h3 is-upgraded>result (Private Subnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Subnet&#34;: {
        &#34;AvailabilityZone&#34;: &#34;ap-northeast-1c&#34;,
        &#34;AvailabilityZoneId&#34;: &#34;apne1-az1&#34;,
        &#34;AvailableIpAddressCount&#34;: 251,
        &#34;CidrBlock&#34;: &#34;10.0.3.0/24&#34;,
        &#34;DefaultForAz&#34;: false,
        &#34;MapPublicIpOnLaunch&#34;: false,
        &#34;State&#34;: &#34;available&#34;,
        &#34;SubnetId&#34;: &#34;subnet-0ea89b6bc85e0ec61&#34;,
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;AssignIpv6AddressOnCreation&#34;: false,
        &#34;Ipv6CidrBlockAssociationSet&#34;: [],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPrivate&#34;
            }
        ],
        &#34;SubnetArn&#34;: &#34;arn:aws:ec2:ap-northeast-1:123456789012:subnet/subnet-0ea89b6bc85e0ec61&#34;,
        &#34;EnableDns64&#34;: false,
        &#34;Ipv6Native&#34;: false,
        &#34;PrivateDnsNameOptionsOnLaunch&#34;: {
            &#34;HostnameType&#34;: &#34;ip-name&#34;,
            &#34;EnableResourceNameDnsARecord&#34;: false,
            &#34;EnableResourceNameDnsAAAARecord&#34;: false
        }
    }
}
</code></pre>
<h2 is-upgraded>â– Subnet IDã®å–å¾—</h2>
<p>ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1aPublic=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPublic&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1a&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1cPublic=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPublic&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1c&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1aPrivate=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPrivate&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1a&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1cPrivate=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPrivate&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1c&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
</code></pre>
<h2 is-upgraded>â– InternetGatewayã®ä½œæˆ</h2>
<p>ãƒ»Internetã®å‡ºå…¥ã‚Šå£ã§ã‚ã‚‹InternetGatewayã‚’ä½œæˆã™ã‚‹</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-internet-gateway \
    --tag-specifications &#34;ResourceType=internet-gateway,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;InternetGateway&#34;: {
        &#34;Attachments&#34;: [],
        &#34;InternetGatewayId&#34;: &#34;igw-0a511ba68ceb84ed8&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;,
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOn&#34;
            }
        ]
    }
}
</code></pre>
<h2 is-upgraded>â– InternetGateway IDã®å–å¾—</h2>
<p>ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">InternetGatewayId=`aws ec2 describe-internet-gateways \
    --query &#39;InternetGateways[*].InternetGatewayId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
InternetGatewayId : ${InternetGatewayId}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
InternetGatewayId : igw-0a511ba68ceb84ed8
</code></pre>
<h2 is-upgraded>â– InternetGatewayã‚’VPCã«Attach</h2>
<p>ãƒ»VPCã¨InternetGatewayã‚’ç´ä»˜ã‘ã—ã€Internetã¨ã®æ¥ç¶šç‚¹ã‚’ä½œæˆã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 attach-internet-gateway \
    --internet-gateway-id ${InternetGatewayId} \
    --vpc-id ${VpcId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">ï¼ˆä½•ã‚‚ãªã—ï¼‰
</code></pre>
<h2 is-upgraded>â– InternetGatewayã‚’VPCã«ç´ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª</h2>
<p>ãƒ»ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 describe-internet-gateways \
    --internet-gateway-ids ${InternetGatewayId} \
    --query &#39;InternetGateways[*].Attachments[*].State&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">available
</code></pre>
<h2 is-upgraded>â– RouteTableã®ä½œæˆ</h2>
<p>ãƒ»PublicSubnetã¨PrivateSubnetã®ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’åˆ¶å¾¡ã™ã‚‹ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™<br> ãƒ»ç¾æ™‚ç‚¹ã§ã¯RouteTableã¨Subnetã®ç´ä»˜ã‘ã¯ãªã„ã§ã™</p>
<h3 is-upgraded>cmd (PublicSubnet)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-route-table \
  --vpc-id ${VpcId} \
  --tag-specifications &#34;ResourceType=route-table,Tags=[{Key=Name,Value=ContainerHandsOnPublic}]&#34;
</code></pre>
<h3 is-upgraded>result (PublicSubnet)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;RouteTable&#34;: {
        &#34;Associations&#34;: [],
        &#34;PropagatingVgws&#34;: [],
        &#34;RouteTableId&#34;: &#34;rtb-00cf30796b25b9bc9&#34;,
        &#34;Routes&#34;: [
            {
                &#34;DestinationCidrBlock&#34;: &#34;10.0.0.0/16&#34;,
                &#34;GatewayId&#34;: &#34;local&#34;,
                &#34;Origin&#34;: &#34;CreateRouteTable&#34;,
                &#34;State&#34;: &#34;active&#34;
            }
        ],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPublic&#34;
            }
        ],
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;
    }
}
</code></pre>
<h3 is-upgraded>cmd (PrivateSubnet)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-route-table \
  --vpc-id ${VpcId} \
  --tag-specifications &#34;ResourceType=route-table,Tags=[{Key=Name,Value=ContainerHandsOnPrivate}]&#34;
</code></pre>
<h3 is-upgraded>result (PrivateSubnet)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;RouteTable&#34;: {
        &#34;Associations&#34;: [],
        &#34;PropagatingVgws&#34;: [],
        &#34;RouteTableId&#34;: &#34;rtb-0afaac377925bca9a&#34;,
        &#34;Routes&#34;: [
            {
                &#34;DestinationCidrBlock&#34;: &#34;10.0.0.0/16&#34;,
                &#34;GatewayId&#34;: &#34;local&#34;,
                &#34;Origin&#34;: &#34;CreateRouteTable&#34;,
                &#34;State&#34;: &#34;active&#34;
            }
        ],
        &#34;Tags&#34;: [
            {
                &#34;Key&#34;: &#34;Name&#34;,
                &#34;Value&#34;: &#34;ContainerHandsOnPrivate&#34;
            }
        ],
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
        &#34;OwnerId&#34;: &#34;123456789012&#34;
    }
}
</code></pre>
<h2 is-upgraded>â– RouteTable IDã®å–å¾—</h2>
<p>ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">RouteTableIdPublic=`aws ec2 describe-route-tables \
  --query &#34;RouteTables[*].RouteTableId&#34; \
  --filters &#34;Name=vpc-id,Values=${VpcId}&#34; \
  &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPublic&#34; \
  --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">RouteTableIdPrivate=`aws ec2 describe-route-tables \
  --query &#34;RouteTables[*].RouteTableId&#34; \
  --filters &#34;Name=vpc-id,Values=${VpcId}&#34; \
  &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOnPrivate&#34; \
  --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
InternetGatewayId : ${InternetGatewayId}
RouteTableIdPublic : ${RouteTableIdPublic}
RouteTableIdPrivate : ${RouteTableIdPrivate}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
InternetGatewayId : igw-0a511ba68ceb84ed8
RouteTableIdPublic : rtb-00cf30796b25b9bc9
RouteTableIdPrivate : rtb-0afaac377925bca9a
</code></pre>
<h2 is-upgraded>â– RouteTableã«Subnetã‚’ç´ä»˜ã‘</h2>
<p>ãƒ»RouteTableã¨Subnetã‚’ç´ä»˜ã‘ã—ã¾ã™</p>
<h3 is-upgraded>cmd (PublicSubnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableIdPublic} \
  --subnet-id ${SubnetId1aPublic}
</code></pre>
<h3 is-upgraded>result (PublicSubnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-0e98cb5f6c54d5d83&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h3 is-upgraded>cmd (PublicSubnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableIdPublic} \
  --subnet-id ${SubnetId1cPublic}
</code></pre>
<h3 is-upgraded>result (PublicSubnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-0f3ca785ae8675b6f&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h3 is-upgraded>cmd (PrivateSubnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableIdPrivate} \
  --subnet-id ${SubnetId1aPrivate}
</code></pre>
<h3 is-upgraded>result (PrivateSubnet 1ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-07f8b8f8aa65d0df8&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h3 is-upgraded>cmd (PrivateSubnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableIdPrivate} \
  --subnet-id ${SubnetId1cPrivate}
</code></pre>
<h3 is-upgraded>result (PrivateSubnet 2ã¤ç›®)</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-008c971373c02cf69&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h2 is-upgraded>â– RouteTableã«InternetGatewayã‚’ç´ä»˜ã‘</h2>
<p>ãƒ»PublicSubnetç”¨ã®RouteTableã«InternetGatewayã‚’ç´ä»˜ã‘ã€Internetã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-route \
  --route-table-id ${RouteTableIdPublic} \
  --destination-cidr-block &#34;0.0.0.0/0&#34; \
  --gateway-id ${InternetGatewayId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Return&#34;: true
}
</code></pre>
<h2 is-upgraded>â– PublicSubnetç”¨ã®SecurityGroupä½œæˆ</h2>
<p>ãƒ»PublicSubnetç”¨ã®SecurityGroupä½œæˆ</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-security-group \
  --group-name PublicSecurityGroup \
  --description &#34;Public Security Group&#34; \
  --vpc-id ${VpcId} \
  --tag-specifications &#34;ResourceType=security-group,Tags=[{Key=Name,Value=ContainerHandsOn-PublicSecurityGroup}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;GroupId&#34;: &#34;sg-01cc901415c240504&#34;,
    &#34;Tags&#34;: [
        {
            &#34;Key&#34;: &#34;Name&#34;,
            &#34;Value&#34;: &#34;ContainerHandsOn-PublicSecurityGroup&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– PublicSunetã®SecurityGroupsIdã®å–å¾—</h2>
<p>ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code>PublicSecurityGroupsId=`aws ec2 describe-security-groups \
  --query &#39;SecurityGroups[*].GroupId&#39; \
  --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn-PublicSecurityGroup&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
InternetGatewayId : ${InternetGatewayId}
RouteTableIdPublic : ${RouteTableIdPublic}
RouteTableIdPrivate : ${RouteTableIdPrivate}
PublicSecurityGroupsId : ${PublicSecurityGroupsId}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
InternetGatewayId : igw-0a511ba68ceb84ed8
RouteTableIdPublic : rtb-00cf30796b25b9bc9
RouteTableIdPrivate : rtb-0afaac377925bca9a
PublicSecurityGroupsId : sg-01cc901415c240504
</code></pre>
<h2 is-upgraded>â– PrivateSubnetç”¨ã®SecurityGroupä½œæˆ</h2>
<p>ãƒ»PrivateSubnetç”¨ã®SecurityGroupä½œæˆ</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-security-group \
  --group-name PrivateSecurityGroup \
  --description &#34;Private Security Group&#34; \
  --vpc-id ${VpcId} \
  --tag-specifications &#34;ResourceType=security-group,Tags=[{Key=Name,Value=ContainerHandsOn-PrivateSecurityGroup}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;,
    &#34;Tags&#34;: [
        {
            &#34;Key&#34;: &#34;Name&#34;,
            &#34;Value&#34;: &#34;ContainerHandsOn-PrivateSecurityGroup&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– PublicSunetã®SecurityGroupsIdã®å–å¾—</h2>
<p>ãƒ»IDã‚’å–å¾—ã—ã€å¤‰æ•°ã«æ ¼ç´ãƒ»ç¢ºèªã‚’è¡Œã„ã¾ã™</p>
<pre><code language="language-CloudShell" class="language-CloudShell">PrivateSecurityGroupsId=`aws ec2 describe-security-groups \
  --query &#39;SecurityGroups[*].GroupId&#39; \
  --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn-PrivateSecurityGroup&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
InternetGatewayId : ${InternetGatewayId}
RouteTableIdPublic : ${RouteTableIdPublic}
RouteTableIdPrivate : ${RouteTableIdPrivate}
PublicSecurityGroupsId : ${PublicSecurityGroupsId}
PrivateSecurityGroupsId : ${PrivateSecurityGroupsId}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
InternetGatewayId : igw-0a511ba68ceb84ed8
RouteTableIdPublic : rtb-00cf30796b25b9bc9
RouteTableIdPrivate : rtb-0afaac377925bca9a
PublicSecurityGroupsId : sg-01cc901415c240504
PrivateSecurityGroupsId : sg-040aff209e1fe59cc
</code></pre>
<h2 is-upgraded>â– PublicSubnetã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ </h2>
<p>ãƒ»Internetã‹ã‚‰ã®HTTPã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 authorize-security-group-ingress \
    --group-id ${PublicSecurityGroupsId} \
    --protocol tcp \
    --port 80 \
    --cidr 0.0.0.0/0
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Return&#34;: true,
    &#34;SecurityGroupRules&#34;: [
        {
            &#34;SecurityGroupRuleId&#34;: &#34;sgr-011c9bf434c9439a0&#34;,
            &#34;GroupId&#34;: &#34;sg-01cc901415c240504&#34;,
            &#34;GroupOwnerId&#34;: &#34;123456789012&#34;,
            &#34;IsEgress&#34;: false,
            &#34;IpProtocol&#34;: &#34;tcp&#34;,
            &#34;FromPort&#34;: 80,
            &#34;ToPort&#34;: 80,
            &#34;CidrIpv4&#34;: &#34;0.0.0.0/0&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– PrivateSubnetã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼‘</h2>
<p>ãƒ»PublicSubnetçµŒç”±ã§ã®HTTPã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 authorize-security-group-ingress \
    --group-id ${PrivateSecurityGroupsId} \
    --protocol tcp \
    --port 80 \
    --source-group ${PublicSecurityGroupsId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Return&#34;: true,
    &#34;SecurityGroupRules&#34;: [
        {
            &#34;SecurityGroupRuleId&#34;: &#34;sgr-0eca9b6518889b4ca&#34;,
            &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;,
            &#34;GroupOwnerId&#34;: &#34;123456789012&#34;,
            &#34;IsEgress&#34;: false,
            &#34;IpProtocol&#34;: &#34;tcp&#34;,
            &#34;FromPort&#34;: 80,
            &#34;ToPort&#34;: 80,
            &#34;ReferencedGroupInfo&#34;: {
                &#34;GroupId&#34;: &#34;sg-01cc901415c240504&#34;
            }
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– PrivateSubnetã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼’</h2>
<p>ãƒ»å¾Œã§è¨­å®šã™ã‚‹VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç‚ºã«HTTPSã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 authorize-security-group-ingress \
    --group-id ${PrivateSecurityGroupsId} \
    --protocol tcp \
    --port 443 \
    --cidr 0.0.0.0/0
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Return&#34;: true,
    &#34;SecurityGroupRules&#34;: [
        {
            &#34;SecurityGroupRuleId&#34;: &#34;sgr-0d637ce636f2f14d9&#34;,
            &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;,
            &#34;GroupOwnerId&#34;: &#34;123456789012&#34;,
            &#34;IsEgress&#34;: false,
            &#34;IpProtocol&#34;: &#34;tcp&#34;,
            &#34;FromPort&#34;: 443,
            &#34;ToPort&#34;: 443,
            &#34;CidrIpv4&#34;: &#34;0.0.0.0/0&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– CloudWatch LogGroupã®ä½œæˆ</h2>
<p>ãƒ»ecsTaskExecutionRoleãŒLogGroupã‚’ä½œæˆã§ããªã„ã®ã§ã€æ‰‹ä½œæˆã—ã¾ã™ã€‚</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws logs create-log-group --log-group-name awslogs-container-hands-on
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">ï¼ˆãªã—ï¼‰
</code></pre>
<h2 is-upgraded>â– CloudWatch LogGroupã®ä½œæˆç¢ºèª</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws logs describe-log-groups --log-group-name-prefix awslogs-container-hands-on
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;logGroups&#34;: [
        {
            &#34;logGroupName&#34;: &#34;awslogs-container-hands-on&#34;,
            &#34;creationTime&#34;: 1662547861755,
            &#34;metricFilterCount&#34;: 0,
            &#34;arn&#34;: &#34;arn:aws:logs:ap-northeast-1:378647896848:log-group:awslogs-container-hands-on:*&#34;,
            &#34;storedBytes&#34;: 0
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– ç’°å¢ƒå¤‰æ•°ã‚’ãƒ¡ãƒ¢</h2>
<p>ãƒ»Cloud9ã§ä½¿ã†ãŸã‚ã€å–å¾—ã—ãŸå¤‰æ•°ã‚’ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«æ®‹ã—ã¦ä¸‹ã•ã„</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
export AccoutID=&#34;${AccoutID}&#34;
export VpcId=&#34;${VpcId}&#34;
export SubnetId1aPublic=&#34;${SubnetId1aPublic}&#34;
export SubnetId1cPublic=&#34;${SubnetId1cPublic}&#34;
export SubnetId1aPrivate=&#34;${SubnetId1aPrivate}&#34;
export SubnetId1cPrivate=&#34;${SubnetId1cPrivate}&#34;
export InternetGatewayId=&#34;${InternetGatewayId}&#34;
export RouteTableIdPublic=&#34;${RouteTableIdPublic}&#34;
export RouteTableIdPrivate=&#34;${RouteTableIdPrivate}&#34;
export PublicSecurityGroupsId=&#34;${PublicSecurityGroupsId}&#34;
export PrivateSecurityGroupsId=&#34;${PrivateSecurityGroupsId}&#34;
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">export AccoutID=&#34;123456789012&#34;
export VpcId=&#34;vpc-0d3c1c88db46cfba7&#34;
export SubnetId1aPublic=&#34;subnet-0f66f257f167a1d47&#34;
export SubnetId1cPublic=&#34;subnet-0a1e2afffc8c140d8&#34;
export SubnetId1aPrivate=&#34;subnet-049f0119237ff00a0&#34;
export SubnetId1cPrivate=&#34;subnet-0ea89b6bc85e0ec61&#34;
export InternetGatewayId=&#34;igw-0a511ba68ceb84ed8&#34;
export RouteTableIdPublic=&#34;rtb-00cf30796b25b9bc9&#34;
export RouteTableIdPrivate=&#34;rtb-0afaac377925bca9a&#34;
export PublicSecurityGroupsId=&#34;sg-01cc901415c240504&#34;
export PrivateSecurityGroupsId=&#34;sg-040aff209e1fe59cc&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Cloud9ä½œæˆ" duration="5">
        <h2 is-upgraded>â– Cloud9ã®ä½œæˆ</h2>
<p>ãƒ»ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã€å®Ÿè¡Œã€ãƒ‡ãƒãƒƒã‚°ã§ãã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®çµ±åˆé–‹ç™ºç’°å¢ƒ (IDE)ã§ã‚ã‚‹Cloud9ã‚’ä½œæˆ</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws cloud9 create-environment-ec2 \
  --name ContainerHandsOn \
  --description &#34;ContainerHandsOn&#34; \
  --instance-type t3.small  \
  --subnet-id ${SubnetId1aPublic}  \
  --automatic-stop-time-minutes 60 
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;environmentId&#34;: &#34;aa2999a731eb4178aed99069f1b683aa&#34;
}
</code></pre>
<h2 is-upgraded>â– AWS ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§Cloud9ã‚’èµ·å‹•</h2>
<ul>
<li>ä¸Šéƒ¨ã®æ¤œç´¢ãƒãƒ¼ã§<code>Cloud9</code>ã¨æ¤œç´¢</li>
<li><code>AWS Cloud9 &gt; Your environments</code>ã«<code>ContainerHandsOn</code>ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã®ã§<code>Open IDE</code>ãƒœã‚¿ãƒ³æŠ¼ä¸‹</li>
<li>Cloud9ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
</ul>
<p>ãƒ»ä»Šå¾Œã®cmdã¯Cloud9ã®bashã¨æ›¸ã‹ã‚ŒãŸTABã®ä¸‹ã«è²¼ã‚Šä»˜ã‘ã¦ã„ãã¾ã™ <a href="./image/img4-1.png" target="_blank"><img alt="img" src="img/ccb3ac339b93cb8e.png"></a></p>
<p>ãƒ»é–“é•ãˆã¦TABã‚’é–‰ã˜ã¦ã—ã¾ã£ãŸå ´åˆã«ã¯ä»¥ä¸‹ã§æ–°ã—ãTABã‚’é–‹ã„ã¦ãã ã•ã„ <a href="./image/img4-2.png" target="_blank"><img alt="img" src="img/944649a354b83dff.png"></a></p>


      </google-codelab-step>
    
      <google-codelab-step label="ECRä½œæˆ" duration="5">
        <h2 is-upgraded>â– ç’°å¢ƒå¤‰æ•°ã‚’è²¼ã‚Šä»˜ã‘</h2>
<p>ãƒ»CloudShellã§å–å¾—ã—ãŸç’°å¢ƒå¤‰æ•°ã‚’Cloud9ã¸ç§»è¨­</p>
<h3 is-upgraded>cmd (ä»¥ä¸‹ã¯ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã«é€€é¿ã—ãŸçµæœã‚’åˆ©ç”¨ãã ã•ã„)</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">export AccoutID=&#34;123456789012&#34;
export VpcId=&#34;vpc-0d3c1c88db46cfba7&#34;
export SubnetId1aPublic=&#34;subnet-0f66f257f167a1d47&#34;
export SubnetId1cPublic=&#34;subnet-0a1e2afffc8c140d8&#34;
export SubnetId1aPrivate=&#34;subnet-049f0119237ff00a0&#34;
export SubnetId1cPrivate=&#34;subnet-0ea89b6bc85e0ec61&#34;
export InternetGatewayId=&#34;igw-0a511ba68ceb84ed8&#34;
export RouteTableIdPublic=&#34;rtb-00cf30796b25b9bc9&#34;
export RouteTableIdPrivate=&#34;rtb-0afaac377925bca9a&#34;
export PublicSecurityGroupsId=&#34;sg-01cc901415c240504&#34;
export PrivateSecurityGroupsId=&#34;sg-040aff209e1fe59cc&#34;
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">clear; cat &lt;&lt; EOF
AccoutID : ${AccoutID}
VpcId : ${VpcId}
SubnetId1aPublic : ${SubnetId1aPublic}
SubnetId1cPublic : ${SubnetId1cPublic}
SubnetId1aPrivate : ${SubnetId1aPrivate}
SubnetId1cPrivate : ${SubnetId1cPrivate}
InternetGatewayId : ${InternetGatewayId}
RouteTableIdPublic : ${RouteTableIdPublic}
RouteTableIdPrivate : ${RouteTableIdPrivate}
PublicSecurityGroupsId : ${PublicSecurityGroupsId}
PrivateSecurityGroupsId : ${PrivateSecurityGroupsId}
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">AccoutID : 123456789012
VpcId : vpc-0d3c1c88db46cfba7
SubnetId1aPublic : subnet-0f66f257f167a1d47
SubnetId1cPublic : subnet-0a1e2afffc8c140d8
SubnetId1aPrivate : subnet-049f0119237ff00a0
SubnetId1cPrivate : subnet-0ea89b6bc85e0ec61
InternetGatewayId : igw-0a511ba68ceb84ed8
RouteTableIdPublic : rtb-00cf30796b25b9bc9
RouteTableIdPrivate : rtb-0afaac377925bca9a
PublicSecurityGroupsId : sg-01cc901415c240504
PrivateSecurityGroupsId : sg-040aff209e1fe59cc
</code></pre>
<h2 is-upgraded>â– ECRã®ä½œæˆ</h2>
<p>ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã§ã‚ã‚‹ECRã‚’ä½œæˆ</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ecr create-repository \
    --repository-name jaws-days-2022/container-hands-on \
    --tags &#34;Key=Name,Value=ContainerHandsOn&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;repository&#34;: {
        &#34;repositoryArn&#34;: &#34;arn:aws:ecr:ap-northeast-1:123456789012:repository/jaws-days-2022/container-hands-on&#34;,
        &#34;registryId&#34;: &#34;123456789012&#34;,
        &#34;repositoryName&#34;: &#34;jaws-days-2022/container-hands-on&#34;,
        &#34;repositoryUri&#34;: &#34;123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on&#34;,
        &#34;createdAt&#34;: &#34;2022-09-06T13:21:42+00:00&#34;,
        &#34;imageTagMutability&#34;: &#34;MUTABLE&#34;,
        &#34;imageScanningConfiguration&#34;: {
            &#34;scanOnPush&#34;: false
        },
        &#34;encryptionConfiguration&#34;: {
            &#34;encryptionType&#34;: &#34;AES256&#34;
        }
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Docker Imageä½œæˆ" duration="5">
        <h2 is-upgraded>â– Cloud9ä¸Šã«dockerã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker -v
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">Docker version 20.10.13, build a224086
</code></pre>
<h2 is-upgraded>â– Cloud9ä¸Šã«Dockerfileã‚’ä½œæˆ</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">cat &lt;&lt; EOF &gt; Dockerfile
FROM php:7.4.0-apache
COPY src/ /var/www/html/
EOF
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">mkdir src
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">cat &lt;&lt; EOF &gt; ./src/index.php
&lt;!DOCTYPE html&gt;
&lt;html lang=&#34;ja&#34;&gt;
  &lt;head&gt;
    &lt;title&gt;Hello! Jaws Days 2022!!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;Hello! Jaws Days 2022!!&lt;/p&gt;
    &lt;?php echo gethostname(); ?&gt;
  &lt;/body&gt;
&lt;/html&gt;
EOF
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">ls -l ./Dockerfile ./src/index.php
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">-rw-rw-r-- 1 ec2-user ec2-user  47 Sep  6 13:26 ./Dockerfile
-rw-rw-r-- 1 ec2-user ec2-user 190 Sep  6 13:26 ./src/index.php
</code></pre>
<h2 is-upgraded>â– Cloud9ä¸Šã§Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ§‹ç¯‰</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker build \
  -t jaws-days-2022/container-hands-on .
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">ï¼ˆç•¥ï¼‰
Successfully built fed9645afaae
Successfully tagged jaws-days-2022/container-hands-on:latest
</code></pre>
<h2 is-upgraded>â– Cloud9ä¸Šã§Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ§‹ç¯‰ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-cloud9" class="language-cloud9">docker images \
  --filter reference= jaws-days-2022/container-hands-on:latest
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-cloud9" class="language-cloud9">REPOSITORY                          TAG       IMAGE ID       CREATED          SIZE
jaws-days-2022/container-hands-on   latest    98c14fa37bab   10 seconds ago   414MB
</code></pre>
<h2 is-upgraded>â– Cloud9ä¸Šã§Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’èµ·å‹•</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker run \
  --name container-hands-on \
  -d -p 8080:80 jaws-days-2022/container-hands-on:latest
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">dcaf3423f6abeea3a67bab0c01a33e7b9d2c97131c8b304900f0455ee73da7b7
</code></pre>
<h3 is-upgraded>ç”»é¢</h3>
<ul>
<li>Cloud9ã®ãƒ˜ãƒƒãƒ€éƒ¨åˆ†ã®<code>Preview</code>-&gt; <code>Preview Runnnig Application</code>ã®ãƒœã‚¿ãƒ³æŠ¼ä¸‹<br></li>
<li><code>Hello! Jaws Days 2022!!</code>ã¨è¨˜è¼‰ã•ã‚ŒãŸç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨<br></li>
</ul>
<p class="image-container"><img alt="img" src="img/2be66bb659acb02.png"></p>
<aside class="special"><p>ä½•ã‹é–“é•ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’æ­¢ã‚ãŸã„å ´åˆã«ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œãã ã•ã„</p>
</aside>
<pre><code language="language-Cloud9" class="language-Cloud9">docker stop $(docker ps -q)
docker rm $(docker ps -q -a)
</code></pre>
<h2 is-upgraded>â– DockerImageã«Tagä»˜ã‘ã‚’è¡Œã†</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker tag \
  jaws-days-2022/container-hands-on:latest `echo ${AccoutID}`.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on:latest
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">ï¼ˆãªã—ï¼‰
</code></pre>
<h2 is-upgraded>â– DockerImageã«Tagä»˜ã‘ã®ç¢ºèª</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker images \
  --filter reference=`echo ${AccoutID}`.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on:latest

</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">REPOSITORY                                                                            TAG       IMAGE ID       CREATED          SIZE
123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on   latest    98c14fa37bab   10 minutes ago   414MB
</code></pre>
<h2 is-upgraded>â– èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å¯¾ã—ã¦ Docker ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èªè¨¼ã—ã¾ã™</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ecr get-login-password \
  --region ap-northeast-1 | \
  docker login \
  --username AWS \
--password-stdin `echo ${AccoutID}`.dkr.ecr.ap-northeast-1.amazonaws.com
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">WARNING! Your password will be stored unencrypted in /home/ec2-user/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
</code></pre>
<h2 is-upgraded>â– DockerImageã‚’ECRã«Push</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">docker push \
  `echo ${AccoutID}`.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on:latest
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">The push refers to repository [123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on]
9f8ad0ecf420: Pushed 
536365481ed8: Pushed 
4b3693c51878: Pushed 
677c3ce9f0b4: Pushed 
c08f4d9c281b: Pushed 
ed13170590f7: Pushed 
37cbdda31557: Pushed 
9691e5d7a4c7: Pushed 
6a4d393f0795: Pushed 
e38834ac7561: Pushed 
ec64f555d498: Pushed 
840f3f414cf6: Pushed 
17fce12edef0: Pushed 
831c5620387f: Pushed 
latest: digest: sha256:1fb5a3ac5ea1e7d60c24f371564a8c2c7bbc8072be0e80a3c53c30e1cae3ffd3 size: 3242
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ" duration="5">
        <p>Fargateã‚’PrivateSubnetã§ç¨¼åƒã•ã›ã‚‹ãŸã‚ã€ä»¥ä¸‹VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æº–å‚™ã—ã¾ã™<br> ECRã«æ ¼ç´ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯é€šå¸¸InternetçµŒç”±ã¨ãªã‚Šã¾ã™ã€ã—ã‹ã—ä»Šå›ã¯Fargateã¯PrivateSubnetã¨ã„ã†Internetã«æ¥ç¶šã•ã‚Œã¦ã„ãªã„ã®ã§ã€InternetçµŒç”±ã§ã¯ECRã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“<br> ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã„ã†Internetã«ç¹‹ãŒã‚‰ãªã„AWSã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§ECRã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã„ã¾ã™ã€‚</p>
<ul>
<li>com.amazonaws.ap-northeast-1.s3</li>
<li>com.amazonaws.ap-northeast-1.ecr.dkr</li>
<li>com.amazonaws.ap-northeast-1.ecr.api</li>
<li>com.amazonaws.ap-northeast-1.logs</li>
</ul>
<h2 is-upgraded>â– com.amazonaws.ap-northeast-1.s3</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ec2 create-vpc-endpoint \
    --vpc-id ${VpcId} \
    --vpc-endpoint-type Gateway \
    --service-name com.amazonaws.ap-northeast-1.s3 \
    --route-table-ids ${RouteTableIdPrivate} \
    --tag-specifications &#34;ResourceType=vpc-endpoint,Tags=[{Key=Name,Value=ContainerHands}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;VpcEndpoint&#34;: {
        &#34;PolicyDocument&#34;: &#34;{\&#34;Version\&#34;:\&#34;2008-10-17\&#34;,\&#34;Statement\&#34;:[{\&#34;Effect\&#34;:\&#34;Allow\&#34;,\&#34;Principal\&#34;:\&#34;*\&#34;,\&#34;Action\&#34;:\&#34;*\&#34;,\&#34;Resource\&#34;:\&#34;*\&#34;}]}&#34;, 
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;, 
        &#34;Tags&#34;: [
            {
                &#34;Value&#34;: &#34;ContainerHands&#34;, 
                &#34;Key&#34;: &#34;Name&#34;
            }
        ], 
        &#34;NetworkInterfaceIds&#34;: [], 
        &#34;SubnetIds&#34;: [], 
        &#34;RequesterManaged&#34;: false, 
        &#34;PrivateDnsEnabled&#34;: false, 
        &#34;State&#34;: &#34;available&#34;, 
        &#34;ServiceName&#34;: &#34;com.amazonaws.ap-northeast-1.s3&#34;, 
        &#34;RouteTableIds&#34;: [
            &#34;rtb-0afaac377925bca9a&#34;
        ], 
        &#34;Groups&#34;: [], 
        &#34;OwnerId&#34;: &#34;123456789012&#34;, 
        &#34;VpcEndpointId&#34;: &#34;vpce-035934e1a19b46f78&#34;, 
        &#34;VpcEndpointType&#34;: &#34;Gateway&#34;, 
        &#34;CreationTimestamp&#34;: &#34;2022-09-06T14:14:54.000Z&#34;, 
        &#34;DnsEntries&#34;: []
    }
}
</code></pre>
<h2 is-upgraded>â– com.amazonaws.ap-northeast-1.ecr.dkr</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ec2 create-vpc-endpoint \
    --vpc-id ${VpcId} \
    --vpc-endpoint-type Interface \
    --service-name com.amazonaws.ap-northeast-1.ecr.dkr \
    --subnet-ids ${SubnetId1aPrivate} ${SubnetId1cPrivate} \
    --security-group-id ${PrivateSecurityGroupsId} \
    --tag-specifications &#34;ResourceType=vpc-endpoint,Tags=[{Key=Name,Value=ContainerHands}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;VpcEndpoint&#34;: {
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;, 
        &#34;Tags&#34;: [
            {
                &#34;Value&#34;: &#34;ContainerHands&#34;, 
                &#34;Key&#34;: &#34;Name&#34;
            }
        ], 
        &#34;NetworkInterfaceIds&#34;: [
            &#34;eni-09e0a49241653c549&#34;, 
            &#34;eni-05e27340a7008c6c5&#34;
        ], 
        &#34;SubnetIds&#34;: [
            &#34;subnet-0ea89b6bc85e0ec61&#34;, 
            &#34;subnet-049f0119237ff00a0&#34;
        ], 
        &#34;RequesterManaged&#34;: false, 
        &#34;PrivateDnsEnabled&#34;: true, 
        &#34;State&#34;: &#34;pending&#34;, 
        &#34;ServiceName&#34;: &#34;com.amazonaws.ap-northeast-1.ecr.dkr&#34;, 
        &#34;RouteTableIds&#34;: [], 
        &#34;Groups&#34;: [
            {
                &#34;GroupName&#34;: &#34;PrivateSecurityGroup&#34;, 
                &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;
            }
        ], 
        &#34;OwnerId&#34;: &#34;123456789012&#34;, 
        &#34;VpcEndpointId&#34;: &#34;vpce-0dceb08e8bffc9a0c&#34;, 
        &#34;VpcEndpointType&#34;: &#34;Interface&#34;, 
        &#34;CreationTimestamp&#34;: &#34;2022-09-06T14:15:53.158Z&#34;, 
        &#34;DnsEntries&#34;: [
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0dceb08e8bffc9a0c-nuehayud.dkr.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0dceb08e8bffc9a0c-nuehayud-ap-northeast-1a.dkr.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0dceb08e8bffc9a0c-nuehayud-ap-northeast-1c.dkr.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;ZONEIDPENDING&#34;, 
                &#34;DnsName&#34;: &#34;dkr.ecr.ap-northeast-1.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;ZONEIDPENDING&#34;, 
                &#34;DnsName&#34;: &#34;*.dkr.ecr.ap-northeast-1.amazonaws.com&#34;
            }
        ]
    }
}
</code></pre>
<h2 is-upgraded>â– com.amazonaws.ap-northeast-1.ecr.api</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ec2 create-vpc-endpoint \
    --vpc-id ${VpcId} \
    --vpc-endpoint-type Interface \
    --service-name com.amazonaws.ap-northeast-1.ecr.api \
    --subnet-ids ${SubnetId1aPrivate} ${SubnetId1cPrivate} \
    --security-group-id ${PrivateSecurityGroupsId} \
    --tag-specifications &#34;ResourceType=vpc-endpoint,Tags=[{Key=Name,Value=ContainerHands}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;VpcEndpoint&#34;: {
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;, 
        &#34;Tags&#34;: [
            {
                &#34;Value&#34;: &#34;ContainerHands&#34;, 
                &#34;Key&#34;: &#34;Name&#34;
            }
        ], 
        &#34;NetworkInterfaceIds&#34;: [
            &#34;eni-084e01fac365b44eb&#34;, 
            &#34;eni-0f8846781b4fb82ee&#34;
        ], 
        &#34;SubnetIds&#34;: [
            &#34;subnet-0ea89b6bc85e0ec61&#34;, 
            &#34;subnet-049f0119237ff00a0&#34;
        ], 
        &#34;RequesterManaged&#34;: false, 
        &#34;PrivateDnsEnabled&#34;: true, 
        &#34;State&#34;: &#34;pending&#34;, 
        &#34;ServiceName&#34;: &#34;com.amazonaws.ap-northeast-1.ecr.api&#34;, 
        &#34;RouteTableIds&#34;: [], 
        &#34;Groups&#34;: [
            {
                &#34;GroupName&#34;: &#34;PrivateSecurityGroup&#34;, 
                &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;
            }
        ], 
        &#34;OwnerId&#34;: &#34;123456789012&#34;, 
        &#34;VpcEndpointId&#34;: &#34;vpce-0e45e7f04848a0600&#34;, 
        &#34;VpcEndpointType&#34;: &#34;Interface&#34;, 
        &#34;CreationTimestamp&#34;: &#34;2022-09-06T14:16:25.698Z&#34;, 
        &#34;DnsEntries&#34;: [
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0e45e7f04848a0600-kef4k347.api.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0e45e7f04848a0600-kef4k347-ap-northeast-1c.api.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-0e45e7f04848a0600-kef4k347-ap-northeast-1a.api.ecr.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;ZONEIDPENDING&#34;, 
                &#34;DnsName&#34;: &#34;api.ecr.ap-northeast-1.amazonaws.com&#34;
            }
        ]
    }
}
</code></pre>
<h2 is-upgraded>â– com.amazonaws.ap-northeast-1.logs</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ec2 create-vpc-endpoint \
    --vpc-id ${VpcId} \
    --vpc-endpoint-type Interface \
    --service-name com.amazonaws.ap-northeast-1.logs \
    --subnet-ids ${SubnetId1aPrivate} ${SubnetId1cPrivate} \
    --security-group-id ${PrivateSecurityGroupsId} \
    --tag-specifications &#34;ResourceType=vpc-endpoint,Tags=[{Key=Name,Value=ContainerHands}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;VpcEndpoint&#34;: {
        &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;, 
        &#34;Tags&#34;: [
            {
                &#34;Value&#34;: &#34;ContainerHands&#34;, 
                &#34;Key&#34;: &#34;Name&#34;
            }
        ], 
        &#34;NetworkInterfaceIds&#34;: [
            &#34;eni-04b15926212e8ea31&#34;, 
            &#34;eni-0514bbba136ec6108&#34;
        ], 
        &#34;SubnetIds&#34;: [
            &#34;subnet-0ea89b6bc85e0ec61&#34;, 
            &#34;subnet-049f0119237ff00a0&#34;
        ], 
        &#34;RequesterManaged&#34;: false, 
        &#34;PrivateDnsEnabled&#34;: true, 
        &#34;State&#34;: &#34;pending&#34;, 
        &#34;ServiceName&#34;: &#34;com.amazonaws.ap-northeast-1.logs&#34;, 
        &#34;RouteTableIds&#34;: [], 
        &#34;Groups&#34;: [
            {
                &#34;GroupName&#34;: &#34;PrivateSecurityGroup&#34;, 
                &#34;GroupId&#34;: &#34;sg-040aff209e1fe59cc&#34;
            }
        ], 
        &#34;OwnerId&#34;: &#34;123456789012&#34;, 
        &#34;VpcEndpointId&#34;: &#34;vpce-05ae88af55de2bf71&#34;, 
        &#34;VpcEndpointType&#34;: &#34;Interface&#34;, 
        &#34;CreationTimestamp&#34;: &#34;2022-09-06T14:16:50.374Z&#34;, 
        &#34;DnsEntries&#34;: [
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-05ae88af55de2bf71-5ltns582.logs.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-05ae88af55de2bf71-5ltns582-ap-northeast-1c.logs.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;Z2E726K9Y6RL4W&#34;, 
                &#34;DnsName&#34;: &#34;vpce-05ae88af55de2bf71-5ltns582-ap-northeast-1a.logs.ap-northeast-1.vpce.amazonaws.com&#34;
            }, 
            {
                &#34;HostedZoneId&#34;: &#34;ZONEIDPENDING&#34;, 
                &#34;DnsName&#34;: &#34;logs.ap-northeast-1.amazonaws.com&#34;
            }
        ]
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ALBä½œæˆ" duration="5">
        <h2 is-upgraded>â– ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ä½œæˆ</h2>
<p>ãƒ»å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¿ã‚¹ã‚¯ã‚’è¤‡æ•°ç«‹ã¦ãŸå ´åˆã«ã€å‡¦ç†ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚’ä½œæˆã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws elbv2 create-load-balancer \
    --name ContainerHandsOn \
    --subnets ${SubnetId1aPublic} ${SubnetId1cPublic} \
    --security-groups ${PublicSecurityGroupsId} \
    --tags &#34;Key=Name,Value=ContainerHandsOn&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;LoadBalancers&#34;: [
        {
            &#34;IpAddressType&#34;: &#34;ipv4&#34;, 
            &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;, 
            &#34;LoadBalancerArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:loadbalancer/app/ContainerHandsOn/75145ed42d9a3867&#34;, 
            &#34;State&#34;: {
                &#34;Code&#34;: &#34;provisioning&#34;
            }, 
            &#34;DNSName&#34;: &#34;ContainerHandsOn-610375823.ap-northeast-1.elb.amazonaws.com&#34;, 
            &#34;SecurityGroups&#34;: [
                &#34;sg-08822a4834ed05f46&#34;
            ], 
            &#34;LoadBalancerName&#34;: &#34;ContainerHandsOn&#34;, 
            &#34;CreatedTime&#34;: &#34;2022-09-06T14:21:35.730Z&#34;, 
            &#34;Scheme&#34;: &#34;internet-facing&#34;, 
            &#34;Type&#34;: &#34;application&#34;, 
            &#34;CanonicalHostedZoneId&#34;: &#34;Z14GRHDCWA56QT&#34;, 
            &#34;AvailabilityZones&#34;: [
                {
                    &#34;SubnetId&#34;: &#34;subnet-0a1e2afffc8c140d8&#34;, 
                    &#34;LoadBalancerAddresses&#34;: [], 
                    &#34;ZoneName&#34;: &#34;ap-northeast-1c&#34;
                }, 
                {
                    &#34;SubnetId&#34;: &#34;subnet-0f66f257f167a1d47&#34;, 
                    &#34;LoadBalancerAddresses&#34;: [], 
                    &#34;ZoneName&#34;: &#34;ap-northeast-1a&#34;
                }
            ]
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ</h2>
<p>ãƒ»ã‚¿ã‚¹ã‚¯ã¯ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ç¨¼åƒã™ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã§ã‚ã‚‹ã‹å®šç¾©ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws elbv2 create-target-group \
    --name ContainerHandsOn \
    --protocol HTTP \
    --port 80 \
    --target-type ip \
    --health-check-protocol HTTP \
    --health-check-port traffic-port \
    --health-check-path /index.php \
    --vpc-id ${VpcId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;TargetGroups&#34;: [
        {
            &#34;TargetGroupArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7624dfd8f556a2d9&#34;,
            &#34;TargetGroupName&#34;: &#34;ContainerHandsOn&#34;,
            &#34;Protocol&#34;: &#34;HTTP&#34;,
            &#34;Port&#34;: 80,
            &#34;VpcId&#34;: &#34;vpc-0d3c1c88db46cfba7&#34;,
            &#34;HealthCheckProtocol&#34;: &#34;HTTP&#34;,
            &#34;HealthCheckPort&#34;: &#34;traffic-port&#34;,
            &#34;HealthCheckEnabled&#34;: true,
            &#34;HealthCheckIntervalSeconds&#34;: 30,
            &#34;HealthCheckTimeoutSeconds&#34;: 5,
            &#34;HealthyThresholdCount&#34;: 5,
            &#34;UnhealthyThresholdCount&#34;: 2,
            &#34;HealthCheckPath&#34;: &#34;/index.php&#34;,
            &#34;Matcher&#34;: {
                &#34;HttpCode&#34;: &#34;200&#34;
            },
            &#34;TargetType&#34;: &#34;ip&#34;,
            &#34;ProtocolVersion&#34;: &#34;HTTP1&#34;,
            &#34;IpAddressType&#34;: &#34;ipv4&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®DNSå–å¾—</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">LoadBalancersDnsName=`aws elbv2 describe-load-balancers \
  --names ContainerHandsOn \
  --query &#34;LoadBalancers[*].DNSName&#34; \
  --output text`
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">echo ${LoadBalancersDnsName}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">ContainerHandsOn-610375823.ap-northeast-1.elb.amazonaws.com
</code></pre>
<h2 is-upgraded>â– ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ARNå–å¾—</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">LoadBalancerArn=`aws elbv2 describe-load-balancers \
  --names ContainerHandsOn \
  --query &#34;LoadBalancers[*].LoadBalancerArn&#34; \
  --output text`
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">echo ${LoadBalancerArn}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:loadbalancer/app/ContainerHandsOn/75145ed42d9a3867
</code></pre>
<h2 is-upgraded>â– ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®ARNå–å¾—</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">TargetGroupArn=`aws elbv2 describe-target-groups \
  --names ContainerHandsOn \
  --query &#34;TargetGroups[*].TargetGroupArn&#34; \
  --output text`
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">echo ${TargetGroupArn}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7f11fa9e9d635ce9
</code></pre>
<h2 is-upgraded>â– ãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ </h2>
<p>ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç´ä»˜ã‘ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws elbv2 create-listener \
    --load-balancer-arn ${LoadBalancerArn} \
    --protocol HTTP \
    --port 80 \
    --default-actions Type=forward,TargetGroupArn=${TargetGroupArn}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;Listeners&#34;: [
        {
            &#34;ListenerArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:listener/app/ContainerHandsOn/75145ed42d9a3867/1245c4be3b3230b7&#34;,
            &#34;LoadBalancerArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:loadbalancer/app/ContainerHandsOn/75145ed42d9a3867&#34;,
            &#34;Port&#34;: 80,
            &#34;Protocol&#34;: &#34;HTTP&#34;,
            &#34;DefaultActions&#34;: [
                {
                    &#34;Type&#34;: &#34;forward&#34;,
                    &#34;TargetGroupArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7f11fa9e9d635ce9&#34;,
                    &#34;ForwardConfig&#34;: {
                        &#34;TargetGroups&#34;: [
                            {
                                &#34;TargetGroupArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7f11fa9e9d635ce9&#34;,
                                &#34;Weight&#34;: 1
                            }
                        ],
                        &#34;TargetGroupStickinessConfig&#34;: {
                            &#34;Enabled&#34;: false
                        }
                    }
                }
            ]
        }
    ]
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Fargateä½œæˆ" duration="5">
        <h2 is-upgraded>â– ECS/Fargateå‘¨è¾ºã®èª¬æ˜</h2>
<h3 is-upgraded>å‚è€ƒ</h3>
<p><a href="https://www.slideshare.net/AmazonWebServicesJapan/20190731-black-belt-online-seminar-amazon-ecs-deep-dive-162160987" target="_blank">20190731 Black Belt Online Seminar Amazon ECS Deep Dive</a></p>
<h3 is-upgraded>ECS on EC2ã®æ§‹æˆå›³</h3>
<p class="image-container"><img alt="img" src="img/f1a8c502f37f27d.png"></p>
<ul>
<li>EC2ä¸Šã§ç¨¼åƒã™ã‚‹Taskã§ã‚³ãƒ³ãƒ†ãƒŠãŒå‡¦ç†ã•ã‚Œã¾ã™</li>
<li>EC2ã‚’è¤‡æ•°å€‹ã¾ã¨ã‚ã¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã—ã¦æ‰±ã„ã¾ã™</li>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç®¡ç†ã‚’ã—ã€ã©ã®EC2ã¸æ–°è¦ã‚¿ã‚¹ã‚¯ã‚’è¨­ã‘ã‚‹ã‹ã¯ECSã®å½¹ç›®ã§ã™</li>
</ul>
<h3 is-upgraded>ECS on Fargateã®æ§‹æˆå›³</h3>
<p class="image-container"><img alt="img" src="img/7c6d141c13fa6ae9.png"></p>
<ul>
<li>ã—ã‹ã—åƒ•ã‚‰ãŒæ³¨åŠ›ã—ãŸã„ã®ã¯ã‚³ãƒ³ãƒ†ãƒŠã§ã©ã®ã‚ˆã†ãªå‡¦ç†ãŒç¨¼åƒã™ã‚‹ã‹ã§ã™</li>
<li>EC2ã®ç®¡ç†ã¯ã‚„ã‚ŠãŸããªã„ã®ã§ã€ãã“ã‚’ãƒãƒãƒ¼ã‚¸ãƒ‰ã—ã¦ãã‚Œã‚‹ã®ãŒFargate</li>
</ul>
<h3 is-upgraded>ECSã®ä¸»è¦è¦ç´ </h3>
<p class="image-container"><img alt="img" src="img/907d8c5dea096b30.png"></p>
<ul>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼šå®Ÿè¡Œç’°å¢ƒã®å¢ƒç•Œç·š</li>
<li>ã‚µãƒ¼ãƒ“ã‚¹ï¼šã‚¿ã‚¹ã‚¯ã‚’ç¶­æŒã™ã‚‹æ©Ÿèƒ½</li>
<li>ã‚¿ã‚¹ã‚¯ï¼šã‚¿ã‚¹ã‚¯å®šç¾©ã«è¨˜è¼‰ã•ã‚ŒãŸå†…å®¹ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠç¾¤</li>
<li>ã‚¿ã‚¹ã‚¯å®šç¾©ï¼šCPU/ãƒ¡ãƒ¢ãƒªã€ç¨¼åƒã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ç­‰ã€ä½•ã‚’ç¨¼åƒã•ã›ã‚‹ã®ã‹ã®å®šç¾©</li>
</ul>
<h2 is-upgraded>â– ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ</h2>
<p>ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã„ã†å®Ÿè¡Œç’°å¢ƒã®å¢ƒç•Œç·šã‚’ä½œæˆã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ecs create-cluster \
    --cluster-name ContainerHandsOn \
    --tags &#34;key=Name,value=ContainerHandsOn&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;cluster&#34;: {
        &#34;status&#34;: &#34;ACTIVE&#34;, 
        &#34;defaultCapacityProviderStrategy&#34;: [], 
        &#34;statistics&#34;: [], 
        &#34;capacityProviders&#34;: [], 
        &#34;tags&#34;: [
            {
                &#34;value&#34;: &#34;ContainerHandsOn&#34;, 
                &#34;key&#34;: &#34;Name&#34;
            }
        ], 
        &#34;clusterName&#34;: &#34;ContainerHandsOn&#34;, 
        &#34;settings&#34;: [
            {
                &#34;name&#34;: &#34;containerInsights&#34;, 
                &#34;value&#34;: &#34;disabled&#34;
            }
        ], 
        &#34;registeredContainerInstancesCount&#34;: 0, 
        &#34;pendingTasksCount&#34;: 0, 
        &#34;runningTasksCount&#34;: 0, 
        &#34;activeServicesCount&#34;: 0, 
        &#34;clusterArn&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:cluster/ContainerHandsOn&#34;
    }
}
</code></pre>
<h2 is-upgraded>â– ã‚¿ã‚¹ã‚¯å®šç¾©ã®ä½œæˆ</h2>
<p>ãƒ»ã©ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ãŒç¨¼åƒã™ã‚‹ã‹ã‚’å®šç¾©ã—ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">cat &lt;&lt; EOF &gt; register-task-definition.json
{
    &#34;family&#34;: &#34;ContainerHandsOn&#34;, 
    &#34;executionRoleArn&#34;: &#34;arn:aws:iam::${AccoutID}:role/ecsTaskExecutionRole&#34;, 
    &#34;networkMode&#34;: &#34;awsvpc&#34;, 
    &#34;containerDefinitions&#34;: [
        {
            &#34;name&#34;: &#34;ContainerHandsOn&#34;, 
            &#34;image&#34;: &#34;${AccoutID}.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on:latest&#34;, 
            &#34;portMappings&#34;: [
                {
                    &#34;containerPort&#34;: 80, 
                    &#34;hostPort&#34;: 80, 
                    &#34;protocol&#34;: &#34;tcp&#34;
                }
            ], 
            &#34;essential&#34;: true,
            &#34;logConfiguration&#34;: {
                &#34;logDriver&#34;: &#34;awslogs&#34;,
                &#34;options&#34;: {
                    &#34;awslogs-create-group&#34;: &#34;true&#34;,
                    &#34;awslogs-group&#34;: &#34;awslogs-container-hands-on&#34;,
                    &#34;awslogs-region&#34;: &#34;ap-northeast-1&#34;,
                    &#34;awslogs-stream-prefix&#34;: &#34;hands-on&#34;
                }
            }
        }
    ], 
    &#34;requiresCompatibilities&#34;: [
        &#34;FARGATE&#34;
    ], 
    &#34;cpu&#34;: &#34;256&#34;, 
    &#34;memory&#34;: &#34;512&#34;,
    &#34;runtimePlatform&#34;: {
        &#34;cpuArchitecture&#34;: &#34;X86_64&#34;,
        &#34;operatingSystemFamily&#34;: &#34;LINUX&#34;
    }
}
EOF
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ecs register-task-definition \
  --cli-input-json file://register-task-definition.json \
  --tags &#34;key=Name,value=ContainerHandsOn&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;taskDefinition&#34;: {
        &#34;taskDefinitionArn&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:task-definition/ContainerHandsOn:1&#34;,
        &#34;containerDefinitions&#34;: [
            {
                &#34;name&#34;: &#34;ContainerHandsOn&#34;,
                &#34;image&#34;: &#34;123456789012.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on:latest&#34;,
                &#34;cpu&#34;: 0,
                &#34;portMappings&#34;: [
                    {
                        &#34;containerPort&#34;: 80,
                        &#34;hostPort&#34;: 80,
                        &#34;protocol&#34;: &#34;tcp&#34;
                    }
                ],
                &#34;essential&#34;: true,
                &#34;environment&#34;: [],
                &#34;mountPoints&#34;: [],
                &#34;volumesFrom&#34;: []
            }
        ],
        &#34;family&#34;: &#34;ContainerHandsOn&#34;,
        &#34;executionRoleArn&#34;: &#34;arn:aws:iam::123456789012:role/ecsTaskExecutionRole&#34;,
        &#34;networkMode&#34;: &#34;awsvpc&#34;,
        &#34;revision&#34;: 1,
        &#34;volumes&#34;: [],
        &#34;status&#34;: &#34;ACTIVE&#34;,
        &#34;requiresAttributes&#34;: [
            {
                &#34;name&#34;: &#34;com.amazonaws.ecs.capability.ecr-auth&#34;
            },
            {
                &#34;name&#34;: &#34;ecs.capability.execution-role-ecr-pull&#34;
            },
            {
                &#34;name&#34;: &#34;com.amazonaws.ecs.capability.docker-remote-api.1.18&#34;
            },
            {
                &#34;name&#34;: &#34;ecs.capability.task-eni&#34;
            }
        ],
        &#34;placementConstraints&#34;: [],
        &#34;compatibilities&#34;: [
            &#34;EC2&#34;,
            &#34;FARGATE&#34;
        ],
        &#34;runtimePlatform&#34;: {
            &#34;cpuArchitecture&#34;: &#34;X86_64&#34;,
            &#34;operatingSystemFamily&#34;: &#34;LINUX&#34;
        },
        &#34;requiresCompatibilities&#34;: [
            &#34;FARGATE&#34;
        ],
        &#34;cpu&#34;: &#34;256&#34;,
        &#34;memory&#34;: &#34;512&#34;,
        &#34;registeredAt&#34;: &#34;2022-09-06T14:59:53.594000+00:00&#34;,
        &#34;registeredBy&#34;: &#34;arn:aws:sts::123456789012:assumed-role/AWSReservedSSO_AWSAdministratorAccess_8fe206b83490a022/ShigeruOda&#34;
    },
    &#34;tags&#34;: [
        {
            &#34;key&#34;: &#34;Name&#34;,
            &#34;value&#34;: &#34;ContainerHandsOn&#34;
        }
    ]
}
</code></pre>
<h2 is-upgraded>â– ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ</h2>
<p>ãƒ»å®Ÿè¡Œæ•°ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘¨ã‚Šã‚’ã¾ã¨ã‚ã¾ã™</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">aws ecs create-service \
    --cluster ContainerHandsOn \
    --service-name ContainerHandsOn \
    --task-definition ContainerHandsOn:1 \
    --desired-count 2 \
    --launch-type FARGATE \
    --platform-version LATEST \
    --network-configuration &#34;awsvpcConfiguration={subnets=[${SubnetId1aPrivate},${SubnetId1cPrivate}],securityGroups=[${PrivateSecurityGroupsId}],assignPublicIp=DISABLED}&#34; \
   --load-balancers targetGroupArn=${TargetGroupArn},containerName=ContainerHandsOn,containerPort=80 
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;service&#34;: {
        &#34;serviceArn&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:service/ContainerHandsOn/ContainerHandsOn&#34;,
        &#34;serviceName&#34;: &#34;ContainerHandsOn&#34;,
        &#34;clusterArn&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:cluster/ContainerHandsOn&#34;,
        &#34;loadBalancers&#34;: [
            {
                &#34;targetGroupArn&#34;: &#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7624dfd8f556a2d9&#34;,
                &#34;containerName&#34;: &#34;ContainerHandsOn&#34;,
                &#34;containerPort&#34;: 80
            }
        ],
        &#34;serviceRegistries&#34;: [],
        &#34;status&#34;: &#34;ACTIVE&#34;,
        &#34;desiredCount&#34;: 2,
        &#34;runningCount&#34;: 0,
        &#34;pendingCount&#34;: 0,
        &#34;launchType&#34;: &#34;FARGATE&#34;,
        &#34;platformVersion&#34;: &#34;LATEST&#34;,
        &#34;platformFamily&#34;: &#34;Linux&#34;,
        &#34;taskDefinition&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:task-definition/ContainerHandsOn:1&#34;,
        &#34;deploymentConfiguration&#34;: {
            &#34;deploymentCircuitBreaker&#34;: {
                &#34;enable&#34;: false,
                &#34;rollback&#34;: false
            },
            &#34;maximumPercent&#34;: 200,
            &#34;minimumHealthyPercent&#34;: 100
        },
        &#34;deployments&#34;: [
            {
                &#34;id&#34;: &#34;ecs-svc/9015413324295259653&#34;,
                &#34;status&#34;: &#34;PRIMARY&#34;,
                &#34;taskDefinition&#34;: &#34;arn:aws:ecs:ap-northeast-1:123456789012:task-definition/ContainerHandsOn:1&#34;,
                &#34;desiredCount&#34;: 2,
                &#34;pendingCount&#34;: 0,
                &#34;runningCount&#34;: 0,
                &#34;failedTasks&#34;: 0,
                &#34;createdAt&#34;: &#34;2022-09-07T02:14:18.688000+00:00&#34;,
                &#34;updatedAt&#34;: &#34;2022-09-07T02:14:18.688000+00:00&#34;,
                &#34;launchType&#34;: &#34;FARGATE&#34;,
                &#34;platformVersion&#34;: &#34;1.4.0&#34;,
                &#34;platformFamily&#34;: &#34;Linux&#34;,
                &#34;networkConfiguration&#34;: {
                    &#34;awsvpcConfiguration&#34;: {
                        &#34;subnets&#34;: [
                            &#34;subnet-0ea89b6bc85e0ec61&#34;,
                            &#34;subnet-049f0119237ff00a0&#34;
                        ],
                        &#34;securityGroups&#34;: [
                            &#34;sg-040aff209e1fe59cc&#34;
                        ],
                        &#34;assignPublicIp&#34;: &#34;DISABLED&#34;
                    }
                },
                &#34;rolloutState&#34;: &#34;IN_PROGRESS&#34;,
                &#34;rolloutStateReason&#34;: &#34;ECS deployment ecs-svc/9015413324295259653 in progress.&#34;
            }
        ],
        &#34;roleArn&#34;: &#34;arn:aws:iam::123456789012:role/aws-service-role/ecs.amazonaws.com/AWSServiceRoleForECS&#34;,
        &#34;events&#34;: [],
        &#34;createdAt&#34;: &#34;2022-09-07T02:14:18.688000+00:00&#34;,
        &#34;placementConstraints&#34;: [],
        &#34;placementStrategy&#34;: [],
        &#34;networkConfiguration&#34;: {
            &#34;awsvpcConfiguration&#34;: {
                &#34;subnets&#34;: [
                    &#34;subnet-0ea89b6bc85e0ec61&#34;,
                    &#34;subnet-049f0119237ff00a0&#34;
                ],
                &#34;securityGroups&#34;: [
                    &#34;sg-040aff209e1fe59cc&#34;
                ],
                &#34;assignPublicIp&#34;: &#34;DISABLED&#34;
            }
        },
        &#34;healthCheckGracePeriodSeconds&#34;: 0,
        &#34;schedulingStrategy&#34;: &#34;REPLICA&#34;,
        &#34;createdBy&#34;: &#34;arn:aws:iam::123456789012:role/aws-reserved/sso.amazonaws.com/ap-northeast-1/AWSReservedSSO_AWSAdministratorAccess_8fe206b83490a022&#34;,
        &#34;enableECSManagedTags&#34;: false,
        &#34;propagateTags&#34;: &#34;NONE&#34;,
        &#34;enableExecuteCommand&#34;: false
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="å‹•ä½œç¢ºèªï¼‘" duration="5">
        <h2 is-upgraded>â– ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">echo &#34;http://&#34;${LoadBalancersDnsName}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">http://ContainerHandsOn-610375823.ap-northeast-1.elb.amazonaws.com
</code></pre>
<h2 is-upgraded>â– ç”»é¢ç¢ºèª</h2>
<ul>
<li>ä¸Šè¨˜ã§å–å¾—ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Chromeãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«è²¼ã‚Šä»˜ã‘ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºã«ãªã‚‹ã“ã¨</li>
<li>æ›´æ–°ã‚’è¡Œã†ã¨2è¡Œç›®ã®hostnameãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆALBã§è² è·åˆ†æ•£ã•ã‚Œã¦ã„ã‚‹ç¢ºèªï¼‰</li>
</ul>
<h3 is-upgraded>ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ï¼‘</h3>
<p class="image-container"><img alt="img" src="img/ca2bd0552b74670.png"></p>
<h3 is-upgraded>ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹ï¼’</h3>
<p class="image-container"><img alt="img" src="img/b321ec2d09376beb.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="å¤‰æ•°æ•´ç†" duration="0">
        <h2 is-upgraded>ã“ã“ã¾ã§å–å¾—ã•ã‚ŒãŸå¤‰æ•°ã‚’æ•´ç†</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">clear; cat &lt;&lt; EOF
export AccoutID=&#34;${AccoutID}&#34;
export VpcId=&#34;${VpcId}&#34;
export SubnetId1aPublic=&#34;${SubnetId1aPublic}&#34;
export SubnetId1cPublic=&#34;${SubnetId1cPublic}&#34;
export SubnetId1aPrivate=&#34;${SubnetId1aPrivate}&#34;
export SubnetId1cPrivate=&#34;${SubnetId1cPrivate}&#34;
export InternetGatewayId=&#34;${InternetGatewayId}&#34;
export RouteTableIdPublic=&#34;${RouteTableIdPublic}&#34;
export RouteTableIdPrivate=&#34;${RouteTableIdPrivate}&#34;
export PublicSecurityGroupsId=&#34;${PublicSecurityGroupsId}&#34;
export PrivateSecurityGroupsId=&#34;${PrivateSecurityGroupsId}&#34;
export LoadBalancerArn=&#34;${LoadBalancerArn}&#34;
export TargetGroupArn=&#34;${TargetGroupArn}&#34;
export LoadBalancersDnsName=&#34;${LoadBalancersDnsName}&#34;
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">export AccoutID=&#34;123456789012&#34;
export VpcId=&#34;vpc-0d3c1c88db46cfba7&#34;
export SubnetId1aPublic=&#34;subnet-0f66f257f167a1d47&#34;
export SubnetId1cPublic=&#34;subnet-0a1e2afffc8c140d8&#34;
export SubnetId1aPrivate=&#34;subnet-049f0119237ff00a0&#34;
export SubnetId1cPrivate=&#34;subnet-0ea89b6bc85e0ec61&#34;
export InternetGatewayId=&#34;igw-0a511ba68ceb84ed8&#34;
export RouteTableIdPublic=&#34;rtb-00cf30796b25b9bc9&#34;
export RouteTableIdPrivate=&#34;rtb-0afaac377925bca9a&#34;
export PublicSecurityGroupsId=&#34;sg-01cc901415c240504&#34;
export PrivateSecurityGroupsId=&#34;sg-040aff209e1fe59cc&#34;
export LoadBalancerArn=&#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:loadbalancer/app/ContainerHandsOn/75145ed42d9a3867&#34;
export TargetGroupArn=&#34;arn:aws:elasticloadbalancing:ap-northeast-1:123456789012:targetgroup/ContainerHandsOn/7f11fa9e9d635ce9&#34;
export LoadBalancersDnsName=&#34;ContainerHandsOn-610375823.ap-northeast-1.elb.amazonaws.com&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="CodeBuildä½œæˆ" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodeDeployä½œæˆ" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodePipelineä½œæˆ" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="Dockerã‚³ãƒ³ãƒ†ãƒŠå†ãƒ“ãƒ«ãƒ‰(Codeã‚·ãƒªãƒ¼ã‚ºã‚’åˆ©ç”¨)" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="å‹•ä½œç¢ºèªï¼’" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="ç‰‡ä»˜ã‘" duration="5">
        <h2 is-upgraded>é€”ä¸­ã®è¦‹å‡ºã—</h2>
<aside class="special"><p>ä½•ã‹ãŠçŸ¥ã‚‰ã›ã‚’æ›¸ããŸã„æ™‚ã®ãƒœãƒƒã‚¯ã‚¹</p>
</aside>
<aside class="warning"><p>ä½•ã‹æ³¨æ„ç‚¹ãªã©ã‚’æ›¸ããŸã„æ™‚ã®ãƒœãƒƒã‚¯ã‚¹</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
