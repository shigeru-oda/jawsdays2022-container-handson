
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>[JAWS DAYS 2022] ハンズオン～コンテナサービスをCI/CDパイプラインでデプロイしよう～</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="[JAWS DAYS 2022] ハンズオン～コンテナサービスをCI/CDパイプラインでデプロイしよう～"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="はじめに" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="VPC作成" duration="5">
        <h2 is-upgraded>■CloudShellの起動</h2>
<h2 is-upgraded>■VPCの作成</h2>
<p>VPCを新規に作成します。</p>
<h3 is-upgraded>cmd</h3>
<p>CloudShellに以下cmdをCopy &amp; Paste</p>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-vpc \
    --cidr-block 10.0.0.0/16 \
    --tag-specification &#34;ResourceType=vpc,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<p>CloudShellに以下のような結果が返却されていることを確認下さい。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">xx
</code></pre>
<h3 is-upgraded>変数設定</h3>
<p>VPC IDを取得します、CloudShellに以下cmdをCopy &amp; Paste。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId=`aws ec2 describe-vpcs \
    --query &#39;Vpcs[*].VpcId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
VpcId : ${VpcId}
EOF
</code></pre>
<h3 is-upgraded>変数設定確認</h3>
<p>IDが取得されていることを確認。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId : vpc-08a77289b9b351429
</code></pre>
<h2 is-upgraded>■Subnetの作成</h2>
<p>作成したVPCの中にSubnetを2つ作成します。</p>
<h3 is-upgraded>cmd1</h3>
<p>Subnetの1つ目を作成します。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $vpcid \
    --availability-zone ap-northeast-1a \
    --cidr-block 10.0.0.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result1</h3>
<p>CloudShellに以下のような結果が返却されていることを確認下さい。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">xxx
</code></pre>
<h3 is-upgraded>cmd2</h3>
<p>Subnetの2つ目を作成します。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-subnet \
    --vpc-id $vpcid \
    --availability-zone ap-northeast-1c \
    --cidr-block 10.0.1.0/24 \
    --tag-specifications &#34;ResourceType=subnet,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result2</h3>
<p>CloudShellに以下のような結果が返却されていることを確認下さい。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">xxx
</code></pre>
<h3 is-upgraded>変数取得</h3>
<p>IDが取得されていることを確認。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1a=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1a&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">SubnetId1c=`aws ec2 describe-subnets \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    &#34;Name=availabilityZone,Values=ap-northeast-1c&#34; \
    --query &#34;Subnets[*].SubnetId&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
VpcId : ${VpcId}
SubnetId1a : ${SubnetId1a}
SubnetId1c : ${SubnetId1c}
EOF
</code></pre>
<h3 is-upgraded>変数設定確認</h3>
<p>IDが取得されていることを確認。ID等は個人個人異なります。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId : vpc-08a77289b9b351429
SubnetId1a : subnet-0ae475cbd47289960
SubnetId1c : subnet-051a32873cc5c562b
</code></pre>
<h2 is-upgraded>■InternetGatewayの作成</h2>
<p>Internetに繋がるInternetGatewayを作成します。</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-internet-gateway \
    --tag-specifications &#34;ResourceType=internet-gateway,Tags=[{Key=Name,Value=ContainerHandsOn}]&#34;
</code></pre>
<h3 is-upgraded>result1</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">xxx
</code></pre>
<h3 is-upgraded>変数設定</h3>
<p>作成したInternet GatewayのIDを取得します。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">InternetGatewayId=`aws ec2 describe-internet-gateways \
    --query &#39;InternetGateways[*].InternetGatewayId&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">cat &lt;&lt; EOF
VpcId : ${VpcId}
SubnetId1a : ${SubnetId1a}
SubnetId1c : ${SubnetId1c}
InternetGatewayId : ${InternetGatewayId}
EOF
</code></pre>
<h3 is-upgraded>変数設定確認</h3>
<p>変数が取得されていることを確認します。</p>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId : vpc-08a77289b9b351429
SubnetId1a : subnet-0ae475cbd47289960
SubnetId1c : subnet-051a32873cc5c562b
InternetGatewayId : igw-0db61da9fcd82b6eb
</code></pre>
<h2 is-upgraded>■InternetGatewayをVPCにAttach</h2>
<p>作成したInternetGatewayをVPCに紐付けします。</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 attach-internet-gateway \
    --internet-gateway-id ${InternetGatewayId} \
    --vpc-id ${VpcId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">（何もなし）
</code></pre>
<h2 is-upgraded>■InternetGatewayをVPCにAttachされていることを確認</h2>
<p>紐付けが正しく行われたことを確認します。</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 describe-internet-gateways \
    --internet-gateway-ids ${InternetGatewayId} \
    --query &#39;InternetGateways[*].Attachments[*].State&#39; \
    --filters &#34;Name=tag-key,Values=Name&#34; \
    &#34;Name=tag-value,Values=ContainerHandsOn&#34; \
    --output text
</code></pre>
<h3 is-upgraded>result</h3>
<p>結果がavailableであること</p>
<pre><code language="language-CloudShell" class="language-CloudShell">available
</code></pre>
<h2 is-upgraded>■RouteTableの確認</h2>
<p>VPC作成時にデフォルトのRouteTableがあるので、このIDを取得します。</p>
<h3 is-upgraded>変数設定</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">RouteTableId=`aws ec2 describe-route-tables \
  --query &#34;RouteTables[*].RouteTableId&#34; \
  --filters &#34;Name=vpc-id,Values=${VpcId}&#34; \
  --output text`
</code></pre>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
VpcId : ${VpcId}
SubnetId1a : ${SubnetId1a}
SubnetId1c : ${SubnetId1c}
InternetGatewayId : ${InternetGatewayId}
RouteTableId : ${RouteTableId}
EOF
</code></pre>
<h3 is-upgraded>変数設定確認</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">VpcId : vpc-08a77289b9b351429
SubnetId1a : subnet-0ae475cbd47289960
SubnetId1c : subnet-051a32873cc5c562b
InternetGatewayId : igw-0db61da9fcd82b6eb
RouteTableId : rtb-01b343a22f94f5031
</code></pre>
<h2 is-upgraded>■RouteTableにSubnetを紐付け</h2>
<h3 is-upgraded>cmd1</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableId} \
  --subnet-id ${SubnetId1a}
</code></pre>
<h3 is-upgraded>result1</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-07e4b9476d5384320&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h3 is-upgraded>cmd2</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 associate-route-table \
  --route-table-id ${RouteTableId} \
  --subnet-id ${SubnetId1c}
</code></pre>
<h3 is-upgraded>result2</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;AssociationId&#34;: &#34;rtbassoc-001ad16bd1720e77c&#34;,
    &#34;AssociationState&#34;: {
        &#34;State&#34;: &#34;associated&#34;
    }
}
</code></pre>
<h2 is-upgraded>■RouteTableにInternetGatewayを紐付け</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws ec2 create-route \
  --route-table-id ${RouteTableId} \
  --destination-cidr-block &#34;0.0.0.0/0&#34; \
  --gateway-id ${InternetGatewayId}
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;Return&#34;: true
}
</code></pre>
<h2 is-upgraded>■変数をメモ</h2>
<p>次章で使うため、取得した変数をエディターに残して下さい。</p>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">clear; cat &lt;&lt; EOF
export VpcId=&#34;${VpcId}&#34;
export SubnetId1a=&#34;${SubnetId1a}&#34;
export SubnetId1c=&#34;${SubnetId1c}&#34;
export InternetGatewayId=&#34;${InternetGatewayId}&#34;
export RouteTableId=&#34;${RouteTableId}&#34;
EOF
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">export VpcId=&#34;vpc-08a77289b9b351429&#34;
export SubnetId1a=&#34;subnet-0ae475cbd47289960&#34;
export SubnetId1c=&#34;subnet-051a32873cc5c562b&#34;
export InternetGatewayId=&#34;igw-0db61da9fcd82b6eb&#34;
export RouteTableId=&#34;rtb-01b343a22f94f5031&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Cloud9作成" duration="5">
        <h2 is-upgraded>■Cloud9の作成</h2>
<h3 is-upgraded>cmd</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">aws cloud9 create-environment-ec2 \
  --name ContainerHandsOn \
  --description &#34;ContainerHandsOn&#34; \
  --instance-type t3.small  \
  --subnet-id ${SubnetId1a}  \
  --automatic-stop-time-minutes 60  \
  --tags &#34;Key=Name,Value=ContainerHandsOn&#34;
</code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-CloudShell" class="language-CloudShell">{
    &#34;environmentId&#34;: &#34;96614b2a3f434be7a83b5dffb22a1f0a&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ECR作成" duration="5">
        <h2 is-upgraded>■ECRの作成</h2>
<h3 is-upgraded>cmd</h3>
<p>aws ecr create-repository </p>
<pre><code>--repository-name jaws-days-2022/container-hands-on \
--tags &#34;Key=Name,Value=ContainerHandsOn&#34;
</code></pre>
<pre><code language="language-Cloud9" class="language-Cloud9"></code></pre>
<h3 is-upgraded>result</h3>
<pre><code language="language-Cloud9" class="language-Cloud9">{
    &#34;repository&#34;: {
        &#34;repositoryArn&#34;: &#34;arn:aws:ecr:ap-northeast-1:378647896848:repository/jaws-days-2022/container-hands-on&#34;,
        &#34;registryId&#34;: &#34;378647896848&#34;,
        &#34;repositoryName&#34;: &#34;jaws-days-2022/container-hands-on&#34;,
        &#34;repositoryUri&#34;: &#34;378647896848.dkr.ecr.ap-northeast-1.amazonaws.com/jaws-days-2022/container-hands-on&#34;,
        &#34;createdAt&#34;: 1662173179.0,
        &#34;imageTagMutability&#34;: &#34;MUTABLE&#34;,
        &#34;imageScanningConfiguration&#34;: {
            &#34;scanOnPush&#34;: false
        },
        &#34;encryptionConfiguration&#34;: {
            &#34;encryptionType&#34;: &#34;AES256&#34;
        }
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="VPCエンドポイント作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="ALB作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="Fargate作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="動作確認" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodeBuild作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodeDeploy作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="CodePipeline作成" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="Dockerコンテナ再ビルド(Codeシリーズを利用)" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="動作確認" duration="5">
        

      </google-codelab-step>
    
      <google-codelab-step label="片付け" duration="5">
        <h2 is-upgraded>途中の見出し</h2>
<aside class="special"><p>何かお知らせを書きたい時のボックス</p>
</aside>
<aside class="warning"><p>何か注意点などを書きたい時のボックス</p>
</aside>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
